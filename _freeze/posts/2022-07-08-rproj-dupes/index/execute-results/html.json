{
  "hash": "9c65ad891aea1f7e9d333253f8df3d54",
  "result": {
    "markdown": "---\ntitle: Stop opening the same RStudio Project twice\ndate: 2022-07-08\nslug: rproj-dupes\ncategories:\n  - r\n  - rstudio\n---\n\n\n![](resources/rproj-dupes.png){fig-alt=\"An RStudio console on startup. After the usual R startup text it says 'Warning message: You've got open RStudio Projects with the same name' followed by a bullet point that says 'sandbox.Rproj'. Overlaid is the macOS item switcher showing that there are indeed two RStudio instances open with that name.\" width=\"100%\"}\n\n## tl;dr \n\nI keep opening more than one instance of the same RStudio Project and it's annoying me, so I wrote a function to warn me on startup.\n\n## Double trouble\n\nSometimes I write code in an RStudio Project and then go and do something else. My memory is terrible, so later I might open a second instance of the same project and wonder what happened to that code I'd written before.\n\nIs there a way to stop this from happening? Maybe there's a setting in RStudio or something? Maybe I should just Google it?\n\nNah, instead I hacked together a little function that can be run on startup to warn me---via both text and audio---if I have multiple RStudio sessions open with the same name. It's called `check_rproj_dupes()`.\n\nNote that the function checks which OS you're using with `.Platform$OS.type`, with the hope that one day I (or you) will write some corresponding code that will work on Windows. I don't use Windows, so I can't test anything.\n\nThe code has a few steps:\n\n1. Pass the `ps` (process status) command with flag `-e` (show all running processes) to the shell via the `system()` function, which is captured in a vector when `intern = TRUE`\n2. Use `grepl()` to isolate the strings that contain the '.RProj' RStudio Project extension\n3. Extract the full paths to the .RProj files\n4. Extract the basenames from the paths (i.e. just the filename for the .RProj)\n5. Compare the basenames to see which are duplicated\n6. Display any matches in a warning message and, if `speak = TRUE`, read aloud a warning message that's passed to the `say` function via `system()`\n\nYeah, this could be simplified, but I'm no code golfer. I just want it to work and for it to be pretty obvious what it's doing.\n\nHere it is (or see it [in a GitHub Gist](https://gist.github.com/matt-dray/b4ff92f01093f512dae99b670e3eddb7), where you can write your suggestions for how to improve it):\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncheck_rproj_dupes <- function(speak = FALSE) {\n\n  os <- .Platform$OS.type\n\n  if (os == \"unix\") {\n\n    ps_out <- system(\"ps -e\", intern = TRUE)\n    ps_rproj <- ps_out[grepl(\".Rproj\", ps_out)]\n    ps_split <- strsplit(ps_rproj, \"\\\\s\")\n    rproj_paths <- lapply(ps_split, function(x) x[grepl(\".Rproj$\", x)])\n    rproj_basenames <- lapply(rproj_paths, basename)\n    rproj_dupes <- sort(unlist(rproj_basenames[duplicated(rproj_basenames)]))\n\n  }\n\n  if (os == \"windows\") {\n    stop(\"Sorry, check_rproj_dupes() doesn't work on Windows yet :-(\")\n  }\n\n  if (length(rproj_dupes) > 0) {\n\n    if (speak & os == \"unix\") {\n\n      dupes_string <- paste(rproj_dupes, collapse = \", \")\n      dupes_string_say <- gsub(\"\\\\.Rproj\", \" dot ar proj \", dupes_string)\n\n      message <- paste(\n        \"say ha, you fool, you have more than one open RStudio Project with\",\n        ifelse(length(rproj_dupes) == 1, \"this name:\", \"these names:\"),\n        dupes_string_say\n      )\n\n      system(message)\n\n    }\n\n    warning(\n      \"You've got open RStudio Projects with the same name:\\n\",\n      paste(\"-\", rproj_dupes, collapse = \"\\n\"), \"\\n\",\n      call. = FALSE\n    )\n\n  }\n\n}\n\ncheck_rproj_dupes()\nrm(check_rproj_dupes)\n```\n:::\n\n\nHow would you actually use this though? \n\nYou can add it to your 'hidden' .Rprofile file, which is a place that you can store code that runs whenever RStudio is started.[^rprofile] Perhaps the easiest way to open it is with `usethis::edit_r_profile()`. Then you can paste in all the code from the block above.[^gist]\n\nOn startup, the code will run and if there's no problem, then you'll see no message. No news is good news.\n\nBut let's say I had opened sandbox.Rproj earlier and was now opening the file again. In this second RStudio instance, the usual R startup message will print, followed by a warning:\n\n```\nWarning message:\nYou've got open RStudio Projects with the same name:\n- sandbox.Rproj \n```\n\nIf `speak = TRUE` then you'll also hear this:\n\n<html><audio controls><source src=\"resources/duplicated.wav\" type=\"audio/wav\"></audio></html>\n\nSo hopefully now I will be less confused when trying to manage my RStudio sessions. At worst I'll be shocked to hear the creepy computer voice tell me I'm a fool.\n\n## Environment {.appendix}\n\n<details><summary>Session info</summary>\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nLast rendered: 2023-06-29 23:59:43 CEST\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nR version 4.3.1 (2023-06-16)\nPlatform: aarch64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.2.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Zurich\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nloaded via a namespace (and not attached):\n [1] htmlwidgets_1.6.2 compiler_4.3.1    fastmap_1.1.1     cli_3.6.1        \n [5] tools_4.3.1       htmltools_0.5.5   rstudioapi_0.14   yaml_2.3.7       \n [9] rmarkdown_2.22    knitr_1.43.1      jsonlite_1.8.5    xfun_0.39        \n[13] digest_0.6.31     rlang_1.1.1       evaluate_0.21    \n```\n:::\n:::\n\n</details>\n\n[^rprofile]: I tend not to put anything in here that would hamper reproducibility, i.e. another user shouldn't have to run anything in my .Rprofile to be able to re-run my scripts on their computer.\n[^gist]: The code is [in a GitHub Gist](https://gist.github.com/matt-dray/b4ff92f01093f512dae99b670e3eddb7) too, so in theory you could pass [the URL to the raw code](https://gist.githubusercontent.com/matt-dray/b4ff92f01093f512dae99b670e3eddb7/raw/517ad944f5c7e2cb97db5515103d409144db7e54/check-rproj-dupes.R) to `source()`. But don't do that because you shouldn't trust me or anyone. And also it won't work if you aren't connected to the internet.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}