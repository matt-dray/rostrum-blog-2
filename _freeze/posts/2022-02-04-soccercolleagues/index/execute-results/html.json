{
  "hash": "e4fcccd4d144a91ff5e796fa35ca9085",
  "result": {
    "markdown": "---\ntitle: 'Introduce me to your {soccercolleagues}'\ndate: 2022-02-04\nslug: soccercolleagues\ncategories:\n  - quiz\n  - r\n  - soccercolleagues\n  - sport\n  - worldfootballR\n---\n\n::: {.cell}\n\n:::\n\n\n![Lee Bowyer and Kieran Dyer: 'team mates' ([BBC via Giphy](https://giphy.com/gifs/h-br-s1h7IGyZC1cQ))](https://media.giphy.com/media/s1h7IGyZC1cQ/giphy.gif){fig-alt=\"Gif of two Newcastle United team mates fight each other on a football pitch.\" width=\"100%\"}\n\n## tl;dr\n\nI made [a quick R package called {soccercolleagues}](https://github.com/matt-dray/soccercolleagues) that for a given player, or players, lets you (a) find all their former team mates in common and (b) sample from them for quiz-based purposes.\n\n## Lord of the Ings\n\nQuiz question:\n\n> Which current Premier League footballer has been team mates with each of the following: Kevin Phillips, Mark Viduka, Dejan Lovren, Danny Ings and Nicky Butt?\n\nI've seen this type of question in pub quizzes, on social media and forwarded on by assorted football nerds. Some are harder than a Roy Keane challenge\n\nBut why use your brain when you could backwards-engineer it programmatically?\n\nI figured I could use R and [the {worldfootballR} package by Jason Zivkovic](https://jaseziv.github.io/worldfootballR/) to fetch squad data from the [Transfermarkt](https://www.transfermarkt.co.uk/) website, then isolate team mates that these players have in common. \n\nAnd why not make it an R package in the process?\n\n## Announce {soccercolleagues}!\n\nI'm pleased to announce the signing of the promising young [{soccercolleagues}](https://github.com/matt-dray/soccercolleagues)[^name] package on a free. Will it live up to the hype?\n\nThe package is available [via GitHub](https://github.com/matt-dray/soccercolleagues), which you can install with help from {remotes}. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"remotes\")  # if not already installed\nremotes::install_github(\"matt-dray/soccercolleagues\")\nlibrary(soccercolleagues)\n```\n:::\n\n\nIn a departure from my usual package production, I've made use of the tidyverse in this one. It also uses the native R pipe, so you'll need R v4.1 or above.[^v4] It works on my computer, which is good enough for me.\n\nAs with many packages showcased on this blog, you should consider this a low-effort artisanal meme. Definitely a proof of concept. I'm not sure if I'll ever come back and improve it. Feel free to [add issues or submit pull requests](https://github.com/matt-dray/soccercolleagues).\n\n## Get stuck in\n\n{soccercolleageus} has three main functions:\n\n1. `get_players()` to fetch squad data from Transfermarkt\n1. `get_colleagues()` to return all the players by season who have been team mates with a named set of players\n1. `sample_colleagues()` to select a random set of team mates for a named player or players\n\nThere's also a secret tiny Shiny app, accessed with `open_colleagues_quiz()`, but it (literally) only presents five player names with buttons to (a) reveal a sampled team mate in common, and (b) generate a new set of player names. You'll need to install {shiny} and {shinyjs} separately if you want to use it (don't use it).\n\nLet's talk through the main functions.\n\n### 1. Get squads by league and season\n\nFirst, let's get all the players from all teams in a given league for a given set of seasons.\n\nI designed the package entirely with the English Premier League in mind because that's the league I'm most accustomed to and because Transfermarkt has data for all its seasons, which began in 1992.[^seriea]\n\nYou pass to `get_players()` the `seasons` you want and the `country` that the league is from. Beware: this could take several minutes.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nepl_players <- get_players(\n  seasons = 1992:2020,\n  country = \"England\"\n)\n\nglimpse(epl_players)\n```\n:::\n\n```\nRows: 20,643\nColumns: 11\n$ player_name    <chr> \"Paul Gerrard\", \"Jon Hallworth\", \"John Keeley\", \"Ian Gray\", \"Craig…\n$ player_pos     <chr> \"Goalkeeper\", \"Goalkeeper\", \"Goalkeeper\", \"Goalkeeper\", \"Centre-Ba…\n$ player_age     <dbl> 19, 26, 30, 17, 20, 19, 19, 40, 29, 26, 27, 24, 26, 26, 26, 25, 26…\n$ nationality    <chr> \"England\", \"England\", \"England\", \"England\", \"England\", \"England\", …\n$ in_squad       <dbl> 27, 16, 29, 12, 35, 1, 35, 1, 40, 9, 33, 36, 41, 37, 6, 42, 15, 32…\n$ appearances    <dbl> 25, 16, 1, 0, 24, 0, 33, 0, 40, 5, 33, 31, 41, 32, 6, 42, 14, 32, …\n$ goals          <dbl> 0, 0, 0, 0, 0, 0, 4, 0, 2, 0, 3, 0, 5, 9, 0, 3, 3, 6, 0, 3, 3, 2, …\n$ minutes_played <dbl> 2250, 1440, 90, 0, 2114, 0, 2953, 0, 3600, 341, 2799, 2522, 3647, …\n$ team_url       <chr> \"https://www.transfermarkt.com/oldham-athletic/startseite/verein/1…\n$ team_name      <chr> \"oldham-athletic\", \"oldham-athletic\", \"oldham-athletic\", \"oldham-a…\n$ season         <chr> \"1992\", \"1992\", \"1992\", \"1992\", \"1992\", \"1992\", \"1992\", \"1992\", \"1…\n```\n\nA dataframe is returned with lots of handy stuff like the player name, team name, season and a bunch of player data. Obviously you could take this data away and do whatever you like with it, it's quite a neat dataset for other, less esoteric analysis of the history of the Premier League.\n\n### 2. Find team mates\n\nNow to filter this information for a given focus player or players.\n\nYou provide the dataframe output of `get_players()` to `get_colleagues()` as the `all_players()` argument, along with a vector of `players` names. The function filters the dataframe down to just the team mates of the selected player or players for the teams and seasons in which they played together.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nteammates <- get_colleagues(\n  all_players = epl_players,\n  players = c(\"Kolo Touré\", \"Yaya Touré\")\n)\n```\n:::\n\n```\nRows: 348\nColumns: 12\n$ focus_name     <chr> \"Kolo Touré\", \"Kolo Touré\", \"Kolo Touré\", \"Kolo Touré\", \"Kolo Tour…\n$ player_name    <chr> \"Stuart Taylor\", \"Richard Wright\", \"Patrick Vieira\", \"Stuart Taylo…\n$ player_pos     <chr> \"Goalkeeper\", \"Goalkeeper\", \"Defensive Midfield\", \"Goalkeeper\", \"D…\n$ player_age     <dbl> 20, 23, 25, 21, 26, 22, 17, 27, 23, 18, 28, 19, 21, 20, 22, 21, 24…\n$ nationality    <chr> \"England\", \"England\", \"France\", \"England\", \"France\", \"England\", \"F…\n$ in_squad       <dbl> 21, 43, 54, 20, 42, 4, 31, 44, 7, 26, 44, 14, 13, 40, 45, 50, 41, …\n$ appearances    <dbl> 15, 22, 54, 13, 42, 0, 22, 44, 0, 24, 44, 11, 13, 40, 44, 49, 40, …\n$ goals          <dbl> 0, 0, 3, 0, 4, 0, 0, 3, 0, 0, 7, 0, 4, 0, 12, 0, 1, 30, 1, 0, 7, 1…\n$ minutes_played <dbl> 1220, 1929, 4702, 1081, 3563, 0, 1347, 3822, 0, 1456, 3926, 728, 1…\n$ team_url       <chr> \"https://www.transfermarkt.com/fc-arsenal/startseite/verein/11/sai…\n$ team_name      <chr> \"fc-arsenal\", \"fc-arsenal\", \"fc-arsenal\", \"fc-arsenal\", \"fc-arsena…\n$ season         <chr> \"2001\", \"2001\", \"2001\", \"2002\", \"2002\", \"2003\", \"2003\", \"2003\", \"2…\n```\n\nYou can see how this could be used to solve our original problem: you can take a named player's unique team mates and find how many are in common with other named players.\n\nWhile `get_colleagues()` effectively returns a filtered dataframe, there's another function to whittle this down to simpler output.\n\n### 3. Sample from common team mates\n\nGiven a named player or players, the `sample_colleagues()` function returns a vector of team mates of size `n`. These are sampled with a weighting by the total number of Premier League minutes played (a very rough way of outputting more well-known players).\n\nYou could apply the function to a single named player if you want, which outputs five sampled team mates.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsample_colleagues(\n  all_players = epl_players,\n  players = \"Craig Bellamy\"\n)\n```\n:::\n\n```\n[1] \"Jordan Henderson\"   \"Rob Lee\"  \"Freddie Ljungberg\"\n[4] \"Patrick Vieira\"   \"Celestine Babayaro\"\n```\n\nOf course, if your chosen player is the _only_ common team mate for the set of output players, then you've got a decent quiz question to test your pals with! \n\nTo check, we can feed these names back into `sample_colleagues()`. I've set the argument `n = 2`: if we get two names then we know the player isn't the only one in common for these five.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsample_colleagues(\n  all_players = epl_players,\n  players = c(\n    \"Jordan Henderson\",\n    \"Rob Lee\",\n    \"Freddie Ljungberg\",\n    \"Patrick Vieira\",\n    \"Celestine Babayaro\"\n  ),\n  n = 2 \n)\n```\n:::\n\n```\n[1] Craig Bellamy\n```\n\nLegend, journeyman.\n\n## There's only one [insert player]\n\nSo what's the answer to the original question?[^answer]\n\n> Which current Premier League footballer was team mates with each of the following: Kevin Phillips, Mark Viduka, Dejan Lovren, Danny Ings and Nicky Butt?\n\nNow we can answer programmatically.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsample_colleagues(\n  all_players = epl_players,\n  players = c(\n    \"Kevin Phillips\",\n    \"Mark Viduka\",\n    \"Dejan Lovren\",\n    \"Danny Ings\",\n    \"Nicky Butt\"\n  ),\n  n = 1\n)\n```\n:::\n\n\n<details><summary>Click for answer!</summary>\n```\n[1] James Milner\n```\n</details>\n\nDid you get it? Was it too easy, too _boring_?[^clue]\n\n## Environment {.appendix}\n\n<details><summary>Session info</summary>\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nLast rendered: 2023-07-06 19:27:32 BST\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nR version 4.3.1 (2023-06-16)\nPlatform: aarch64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.2.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/London\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n[1] soccercolleagues_0.0.0.9001\n\nloaded via a namespace (and not attached):\n [1] htmlwidgets_1.6.2 compiler_4.3.1    fastmap_1.1.1     cli_3.6.1        \n [5] tools_4.3.1       htmltools_0.5.5   rstudioapi_0.14   yaml_2.3.7       \n [9] rmarkdown_2.23    knitr_1.43.1      jsonlite_1.8.7    xfun_0.39        \n[13] digest_0.6.31     rlang_1.1.1       evaluate_0.21    \n```\n:::\n:::\n\n</details>\n\n[^answer]: I don't think this is too hard. A friend sent me a harder one where the answer was Alan Hutton, so.\n[^name]: Yeah, couldn't think of a pun quick enough, but I thought the idea of team mates as 'colleagues' is quite funny to me.\n[^v4]: I'm not trying to be restrictive, I just started coding it this way and don't have the time to refactor it.\n[^clue]: A sneaky clue there.\n[^seriea]: You could instead try [one of the many other leagues](https://github.com/JaseZiv/worldfootballR_data/blob/master/raw-data/transfermarkt_leagues/main_comp_seasons.csv) like Italy's Serie A, South Korea's K League, or Tunisia's Ligue I Pro.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}