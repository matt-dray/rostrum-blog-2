{
  "hash": "057dbc43066b1c6759d265af660ea055",
  "result": {
    "markdown": "---\ntitle: Unlock R functions with QR codes\ndate: 2023-11-01\nslug: qr-enable-fn\ncategories:\n  - opencv\n  - qrcode\n  - r\n---\n\n\n![Uh uh uh!](resources/uhuhuh.png){fig-alt=\"Screenshot of the computer from Jurassic Park with repeating monospace text in all caps saying 'you didn't say the magic word' and a photo of the antagonist's (Nedry's) head on a cartoon body wagging his finger.\"}\n\n## tl;dr\n\nWhat if (hear me out) you could prevent an R function from operating correctly unless the user presents a specific QR code?\n\n## QR you?\n\n[Jeroen announced](https://ropensci.org/blog/2023/10/30/opencv-qr/) that the latest version of [the {opencv} package](https://ropensci.r-universe.dev/opencv#) is capable of detecting and decoding a QR code.\n\nSo this means we could write a function that only returns an answer when you introduce a QR code that encodes the correct 'password'.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nadd_one <- function(n) {\n  \n  string_in <- opencv::qr_scanner()\n  password <- RCurl::base64Decode(\"b3BlbmN2IHNlc2FtZSE=\")\n  \n  if (string_in == password) {\n    cat(\"ðŸ”‘ Correct password!\\n\")\n    n + 1\n  } else {\n    stop(\"Wrong password!\", call. = FALSE)\n  }\n  \n}\n```\n:::\n\n\nSo `add_one()` uses the `qr_scanner()` function to find and read a QR code from a video image and compare that to a password before giving the answer. You can see in the function body that I've only mildly obfuscated the password, using base64 encoding. Maybe you can do something more secure?\n\nNow to run the function:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nadd_one(1)\n```\n:::\n\n```\nStarting video window (could be behind this window)\n```\n\nThis will activate your device's camera and it will keep looking for a QR code before it runs the rest of the code in the function.\n\nThe 'correct' QR code (made with [{qrcode}](https://cran.r-project.org/package=qrcode)) is this one:\n\n![Maybe this is a rickroll, who knows?](resources/qr.png){fig-alt=\"A QR code.\" width=25% fig-align=\"left\"}\n\nIf you then scan this QR code with your device you'll get an answer:\n\n```\nCorrect password!\n[1] 2\n```\n\nHere's a gif of the process:\n\n![Halloween special: the QR code appears like a jumpscare ](resources/add-one-qr.gif){fig-alt=\"Screengrab gif. An R function called 'add_one' is run in the terminal with the argument '1'. A message is printed saying 'Starting video window (could be behind this window)' and then a video image appears, showing the corner of a room. A phone displaying a QR code flashes briefly in front of the screen. The Terminal window returns and the message 'correct password' is displayed, along with the answer value of '2'.\" width=75% fig-align=\"left\"}\n\nThe `add_one()` function was run, my laptop's camera opened and then I showed it the QR code on my phone. The code was detected super quickly and the correct answer was returned in the console.\n\nI think there's a lot of promise in this approach for helping to [monetise your R package](https://www.rostrum.blog/posts/2023-08-01-monetize/)!\n\n## Environment {.appendix}\n\n<details><summary>Session info</summary>\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nLast rendered: 2023-11-01 01:17:33 GMT\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nR version 4.3.1 (2023-06-16)\nPlatform: aarch64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.2.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/London\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nloaded via a namespace (and not attached):\n [1] htmlwidgets_1.6.2 compiler_4.3.1    fastmap_1.1.1     cli_3.6.1        \n [5] tools_4.3.1       htmltools_0.5.6.1 rstudioapi_0.15.0 yaml_2.3.7       \n [9] rmarkdown_2.25    knitr_1.44        jsonlite_1.8.7    xfun_0.40        \n[13] digest_0.6.33     rlang_1.1.1       evaluate_0.22    \n```\n:::\n:::\n\n</details>\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}