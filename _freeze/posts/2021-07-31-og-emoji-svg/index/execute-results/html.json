{
  "hash": "646b9a39d2835445c14a3d0dbddc5986",
  "result": {
    "markdown": "---\ntitle: OG emoji SVGs\ndate: 2021-07-31\nslug: og-emoji-svg\ncategories:\n  - emoji\n  - magick\n  - png\n  - polite\n  - r\n  - svg\n  - webscrape\n---\n\n\n![](resources/emoji-grid.png){fig-alt=\"A 10 by 9 grid of pixelated emojis coloured with random rainbow colours. Examples include a cat face, a fax machine and thumbs up.\" width=\"100%\"}\n\n## tl;dr\n\nI [wrote code to produce SVG versions of the 'first-ever' emoji set](https://github.com/matt-dray/og-emoji-svg). Using R, I scraped [Emojipedia](https://blog.emojipedia.org/) with the [{polite}](https://dmi3kno.github.io/polite/) package and then handled images with [{png}](https://cran.r-project.org/package=png), [{magick}](https://docs.ropensci.org/magick/index.html) and [{svglite}](https://svglite.r-lib.org/reference/svglite.html).\n\n## Important archival work\n\nI posted recently on [creating 'pixel art' in R](https://www.rostrum.blog/2021/06/28/pixel-art/) and have since stumbled upon [an old post by mikefc on the coolbutuseless blog](https://coolbutuseless.github.io/2018/08/13/gganimate-with-sprites/) with a method that makes it easier to convert from an image to its 'pixels'.\n\nI've also learnt recently of [Emil's development of the {emoji} package](https://emilhvitfeldt.github.io/emoji/) for R (superseding [Hadley's GitHub-only {emo} package](https://github.com/hadley/emo)).\n\nSpeaking of emoji, [Jeremy Burge](https://en.wikipedia.org/wiki/Jeremy_Burge) and colleagues have worked hard to archive and document them on [Emojipedia](https://blog.emojipedia.org/). They posted recently about the discovery that [the first emoji set was likely to be from SoftBank in 1997](https://blog.emojipedia.org/correcting-the-record-on-the-first-emoji-set/), rather than [the NTT DOCOMO set that was acquired by MoMA](https://stories.moma.org/the-original-emoji-set-has-been-added-to-the-museum-of-modern-arts-collection-c6060e141f61).\n\nAs a mash-up of these things, I've decided to create SVG versions of the original SoftBank set. This format means that the images can be resized without loss of resolution and can be adapted in other ways, like being recoloured.\n\nThe approach:\n\n1. Scrape the Emojipedia hub page for SoftBank's 1997 emojis\n1. Scrape each emoji's dedicated page to retrieve its image path\n1. Download each image (gif format)\n1. Convert gifs to PNGs to matrices\n1. Convert matrices to plots to SVGs\n\nThe packages we need are all available from CRAN with `install.packages()`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsuppressPackageStartupMessages({\n  library(polite)\n  library(rvest)\n  library(purrr)\n  library(svglite)\n  library(png)\n  library(magick)\n})\n```\n:::\n\n\nAll the code here is available in [a GitHub repo](https://github.com/matt-dray/og-emoji-svg).\n\n## Scrape politely\n\nIt's best to scrape using [the {polite} package](https://dmi3kno.github.io/polite/), which allows you to identify yourself to the target website and observe any requests to delay between scrapes. I've [written about this before](https://www.rostrum.blog/2019/03/04/polite-webscrape/).\n\nFirst we `bow()` to the site by providing our information and saying where we want to scrape. The returned object contains information that {polite} uses to decide whether scraping is allowed and whether a crawl delay is required.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nep_bow <- bow(\n  url = \"https://emojipedia.org/softbank/1997\",\n  user_agent = \"M Dray <https://www.matt-dray.com>\"\n)\n\nep_bow\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n<polite session> https://emojipedia.org/softbank/1997\n    User-agent: M Dray <https://www.matt-dray.com>\n    robots.txt: 1 rules are defined for 1 bots\n   Crawl delay: 5 sec\n  The path is scrapable for this user-agent\n```\n:::\n:::\n\n\nFrom [the SoftBank 1997 hub page](https://emojipedia.org/softbank/1997/) of [Emojipedia](https://blog.emojipedia.org/) we can scrape the URLs that lead to each emoji's dedicated page. [The {rvest} package](https://rvest.tidyverse.org/) has some handy functions that help us manipulate the retrieved HTML after scraping with {polite}, which rate-limits us to a retrieval every 5 seconds, given the information returned from our `bow()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsb_urls <- scrape(ep_bow) |> html_nodes(\"a\") |> html_attr(\"href\")\nsb97_urls <- sb_urls[grepl(\"/1997/\", sb_urls) & !grepl(\"more\", sb_urls)]\nhead(sb97_urls)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"/softbank/1997/grinning-face-with-big-eyes/\"   \n[2] \"/softbank/1997/smiling-face-with-smiling-eyes/\"\n[3] \"/softbank/1997/disappointed-face/\"             \n[4] \"/softbank/1997/angry-face/\"                    \n[5] \"/softbank/1997/pile-of-poo/\"                   \n[6] \"/softbank/1997/kiss-mark/\"                     \n```\n:::\n:::\n\n\nFrom this we can get the full list of 90 emoji names for the 1997 SoftBank set.\n\n<details><summary>Click to expand full list of emoji names</summary>\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbasename(sb97_urls)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"grinning-face-with-big-eyes\"    \"smiling-face-with-smiling-eyes\"\n [3] \"disappointed-face\"              \"angry-face\"                    \n [5] \"pile-of-poo\"                    \"kiss-mark\"                     \n [7] \"broken-heart\"                   \"red-heart\"                     \n [9] \"raised-hand\"                    \"victory-hand\"                  \n[11] \"index-pointing-up\"              \"thumbs-up\"                     \n[13] \"raised-fist\"                    \"oncoming-fist\"                 \n[15] \"boy\"                            \"girl\"                          \n[17] \"man\"                            \"woman\"                         \n[19] \"baby-angel\"                     \"person-surfing\"                \n[21] \"dog-face\"                       \"cat-face\"                      \n[23] \"tiger-face\"                     \"horse-face\"                    \n[25] \"mouse-face\"                     \"bear\"                          \n[27] \"penguin\"                        \"spouting-whale\"                \n[29] \"fish\"                           \"cherry-blossom\"                \n[31] \"rose\"                           \"shortcake\"                     \n[33] \"hot-beverage\"                   \"cocktail-glass\"                \n[35] \"beer-mug\"                       \"fork-and-knife\"                \n[37] \"mount-fuji\"                     \"house\"                         \n[39] \"office-building\"                \"church\"                        \n[41] \"sunrise-over-mountains\"         \"railway-car\"                   \n[43] \"bullet-train\"                   \"station\"                       \n[45] \"automobile\"                     \"fuel-pump\"                     \n[47] \"sailboat\"                       \"airplane\"                      \n[49] \"twelve-oclock\"                  \"one-oclock\"                    \n[51] \"two-oclocktime\"                 \"three-oclock\"                  \n[53] \"four-oclock\"                    \"five-oclock\"                   \n[55] \"six-oclock\"                     \"seven-oclock\"                  \n[57] \"eight-oclock\"                   \"nine-oclock\"                   \n[59] \"ten-oclock\"                     \"eleven-oclock\"                 \n[61] \"crescent-moon\"                  \"sun\"                           \n[63] \"cloud\"                          \"umbrella-with-rain-drops\"      \n[65] \"snowman-without-snow\"           \"christmas-tree\"                \n[67] \"soccer-ball\"                    \"baseball\"                      \n[69] \"tennis\"                         \"flag-in-hole\"                  \n[71] \"skis\"                           \"t-shirt\"                       \n[73] \"running-shoe\"                   \"ring\"                          \n[75] \"gem-stone\"                      \"musical-note\"                  \n[77] \"microphone\"                     \"saxophone\"                     \n[79] \"guitar\"                         \"trumpet\"                       \n[81] \"mobile-phone\"                   \"telephone\"                     \n[83] \"fax-machine\"                    \"laptop\"                        \n[85] \"movie-camera\"                   \"camera\"                        \n[87] \"key\"                            \"question-mark\"                 \n[89] \"exclamation-mark\"               \"trident-emblem\"                \n```\n:::\n:::\n\n\n</details>\n\nNow, thanks to [the {purrr} package](https://purrr.tidyverse.org/), we can iterate over these pages and extract each emoji image URL.[^pipe] You have to update your `bow()` with a `nod()` for each new page you want to scrape.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nscrape_sb_gif <- function(sb_ext, bow = ep_bow) {\n  session <- nod(ep_bow, sb_ext)\n  images <- scrape(session) |> html_nodes(\"img\") |> html_attr(\"src\")\n  images[grepl(\".gif$\", images)]\n}\n\nsb97_img <- map_chr(sb97_urls, scrape_sb_gif)\n\nhead(sb97_img)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"https://em-content.zobj.net/thumbs/160/softbank/182/smiling-face-with-open-mouth_1f603.gif\"  \n[2] \"https://em-content.zobj.net/thumbs/160/softbank/182/smiling-face-with-smiling-eyes_1f60a.gif\"\n[3] \"https://em-content.zobj.net/thumbs/160/softbank/182/disappointed-face_1f61e.gif\"             \n[4] \"https://em-content.zobj.net/thumbs/160/softbank/182/angry-face_1f620.gif\"                    \n[5] \"https://em-content.zobj.net/thumbs/160/softbank/182/pile-of-poo_1f4a9.gif\"                   \n[6] \"https://em-content.zobj.net/thumbs/160/softbank/182/kiss-mark_1f48b.gif\"                     \n```\n:::\n:::\n\n\nSo, looks like these are stored on AWS servers.\n\n## Download and convert\n\nNow we can download the emoji images. Here I'm going to download them to a temporary folder. I've also chosen to insert manually a random one- to five-second delay between downloads here to limit the impact on the server.\n\nNote that the `download.file()` function prints an output for each downloaded file, but I've hidden this because there's 90 outputs.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create temporary folder to write into\ntmp <- tempdir()\n\n# Download each file and give it the emoji name\nwalk2(\n  sb97_img,\n  basename(sb97_urls),\n  ~{ cat(\"Downloading\", .y, \"\\n\")\n    download.file(.x, file.path(tmp, paste0(.y, \".gif\")))\n    Sys.sleep(sample(1:5, 1)) }\n)\n```\n:::\n\n\nWe actually want PNG format for the next step, not gifs. One way to do this is to read in the gifs as [{magick}](https://docs.ropensci.org/magick/index.html) objects and then write them back out to png.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngif_paths <- list.files(tmp, pattern = \".gif\", full.names = TRUE)\npng_paths <- gsub(\"gif\", \"png\", gif_paths)\n\nwalk2(\n  gif_paths,\n  png_paths,\n  ~image_read(.x) |> image_write(.y, format = \"png\")\n)\n```\n:::\n\n\n## Generate outputs\n\n### Pixel plots\n\nFirst, we need a function to read the PNGs and create a 32 by 32 matrix representing the pixels of the image.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npixelate_emoji <- function(path_in) {\n  x <- readPNG(path_in)\n  y <- matrix(as.vector(x), 32)\n  t(y[nrow(y):1, 33:64])\n}\n```\n:::\n\n\nWe can take the matrix output from `pixelate_emoji()` and create a plot of that emoji's pixels using the `image()` function from base R.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_emoji <- function(emo_mat, col_px = \"black\", col_bg = \"white\") {\n  image(\n    emo_mat,\n    col = c(col_bg, col_px),\n    useRaster = TRUE,\n    axes = FALSE, xaxs = NULL, yaxs = NULL\n  )\n}\n```\n:::\n\n\nWe can create a grid of them all.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow = c(10, 9), mar = rep(1, 4))\nwalk(png_paths, ~pixelate_emoji(.x) |> plot_emoji())\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot-emoji-grid-1.png){fig-alt='A 10 by 9 grid of black-and-white pixelated emoji from the original 1997 SoftBank set.' width=100%}\n:::\n:::\n\n\nSome are a bit peculiar. The faces look like onions or dumplings, for example. But the vast majority are recognisable as emoji that persist today. Note the poo with a smiley face; this emoji is not recent!\n\nHere's three emoji, but closer.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow = c(1, 3), mar = rep(1, 4))\nwalk(\n  png_paths[c(82, 19, 55)],\n  ~pixelate_emoji(.x) |> plot_emoji()\n)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot-three-emoji-1.png){fig-alt='Three black-and-white pixelated emoji from the original 1997 SoftBank set. From left-to-right they are a thumbs-up, a disappointed face and a smiling poo.' width=100%}\n:::\n:::\n\n\nOr, in modern parlance: üëçüòûüí©\n\n### Write SVGs\n\nWe can save each plot into [SVG (Scalable Vector Graphics) format](https://en.wikipedia.org/wiki/Scalable_Vector_Graphics) using [the {svglite} package](https://svglite.r-lib.org/reference/svglite.html), which can be put in a function that accepts a matrix that's output from `pixelate_emoji()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsave_emoji <- function(emo_mat, file_out, dimn = 10) {\n  svglite(file_out, width = dimn, height = dimn)\n  par(mar = rep(0, 4), mfrow = c(1, 1))\n  plot_emoji(emo_mat)\n  dev.off()\n}\n```\n:::\n\n\nNow to convert all the PNGs to SVGs.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsvg_paths <- gsub(\"png\", \"svg\", png_paths)\n\nwalk2(\n  png_paths, \n  svg_paths,\n  ~save_emoji(pixelate_emoji(.x), file_out = .y)\n) \n```\n:::\n\n\nWe can demonstrate the benefit of SVGs by plotting a scraped PNG emoji (the excellent 'spouting whale') at small, medium and large sizes (25, 100 and 500 pixels square) and then do the same for the SVGs.\n\nFirst the PNG, which look more fuzzy as the image gets larger:\n\n![](resources/spouting-whale.png){width=25px height=25px}\n![](resources/spouting-whale.png){width=100px height=100px}\n![](resources/spouting-whale.png){width=500px height=500px}\n\nNow the SVGs, which look sharp at all sizes:\n\n![](resources/spouting-whale.svg){width=25px height=25px}\n![](resources/spouting-whale.svg){width=100px height=100px}\n![](resources/spouting-whale.svg){width=500px height=500px}\n\nThis happens because an SVG is basically a text file of instructions on how to build the image that an interpreter can re-build from scratch at any size. Hence the word 'scalable' in 'SVG'.\n\n## Licensing?\n\nThis was a project to remind me about 'polite' scraping and the powers of SVG graphics. But maybe the outputs could be useful for archival purposes or something? \n\nI can't be completely certain of licensing for this particular emoji set (even [Emojipedia isn't always sure](https://emojipedia.org/licensing/)), but I certainly can't and don't condone their use for any commercial activities; they belong to [SoftBank](https://en.wikipedia.org/wiki/SoftBank_Group). I've used a few images in this post for demonstration purposes only.\n\nI've made the code [available in a GitHub repo](https://github.com/matt-dray/og-emoji-svg) that you can use for personal investigation, but I haven't included any of the outputs there. Let me know if you find a use for this, lol.\n\n## Environment {.appendix}\n\n<details><summary>Session info</summary>\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nLast rendered: 2023-07-09 11:20:59 BST\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nR version 4.3.1 (2023-06-16)\nPlatform: aarch64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.2.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/London\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n[1] magick_2.7.4  png_0.1-8     svglite_2.1.1 purrr_1.0.1   rvest_1.0.3  \n[6] polite_0.1.3 \n\nloaded via a namespace (and not attached):\n [1] jsonlite_1.8.7    compiler_4.3.1    selectr_0.4-2     Rcpp_1.0.11      \n [5] xml2_1.3.4        stringr_1.5.0     assertthat_0.2.1  spiderbar_0.2.5  \n [9] systemfonts_1.0.4 yaml_2.3.7        fastmap_1.1.1     mime_0.12        \n[13] R6_2.5.1          curl_5.0.1        knitr_1.43.1      htmlwidgets_1.6.2\n[17] rlang_1.1.1       cachem_1.0.8      stringi_1.7.12    xfun_0.39        \n[21] fs_1.6.2          memoise_2.0.1     cli_3.6.1         magrittr_2.0.3   \n[25] digest_0.6.31     rstudioapi_0.14   lifecycle_1.0.3   ratelimitr_0.4.1 \n[29] vctrs_0.6.3       robotstxt_0.7.13  evaluate_0.21     glue_1.6.2       \n[33] rmarkdown_2.23    httr_1.4.6        tools_4.3.1       usethis_2.2.1    \n[37] htmltools_0.5.5  \n```\n:::\n:::\n\n</details>\n\n[^pipe]: Note that I'm using the new (at time of writing) base R pipe, `|>`, rather than the {magrittr} pipe, `%>%`, so you'll need R v4.1 or higher to run this code.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}