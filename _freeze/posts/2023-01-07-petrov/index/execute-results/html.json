{
  "hash": "f94e17273ff6511952ecd4d8119bd5e4",
  "result": {
    "markdown": "---\ntitle: 'Stiliyan Petrov: Jesus?'\nauthor: Matt Dray\ndate: '2023-01-08'\nslug: petrov\ncategories:\n  - code\ntags:\n  - football\n  - opta\n  - r\n  - soccer\n  - soccercolleagues\ndraft: no\n---\n\n\n<div class=\"figure\">\n<img src=\"/post/2023-01-07-petrov_files/petrov.jpg\" alt=\"Close up of former footballer Stiliyan Petrov playing for Bulgaria. Text around his head says 'Stan Petrov', 'am jebus?', 'nativity' and 'get rekt opta' in Comic Sans font.\" width=\"100%\"/>\n</div>\n\n# tl;dr\n\nIn which I prove wrong a tweeted [Opta](https://en.wikipedia.org/wiki/Opta_Sports) football statistic, using R and Transfermarkt data. Oh wait, actually Opta were right. Ah, heck.\n\n# Petrov Rescue\n\nBasically, for little reason, I dislike the style of the tweets on [the Twitter feed for Opta](https://twitter.com/OptaJoe/)[^sponsor] (the company who do all the football stats).\n\nWhat is so outrageous? Each tweet always ends in a single, summary word that makes me cringe. \n\nWait, what? Let's take a look at [their most recent tweet](https://twitter.com/OptaJoe/status/1611735498233622534?s=20) at time of writing:\n\n> 14 - Harry Kane has scored 14 goals in his last 14 appearances in the FA Cup, averaging a goal every 63 minutes in the competition in this period. Guarantee.\n\n'Guarantee'. Gah.\n\nOr [this tweet](https://twitter.com/OptaJoe/status/1611722890298404866?s=20): \n\n> 16 - Since his first appearance in the competition in January 2016, Leicester's Kelechi Iheanacho has scored more FA Cup goals than any other player (16). Specialist.\n\n'Specialist'. Sigh.\n\nA completely small and pointless thing to be annoyed by, right?\n\nBut here's the scenario. Over the yuletide period (on Christmas day!) they ran [this tweet](https://twitter.com/OptaJoe/status/1607028528289030144?s=20):\n\n> 1 - Stiliyan Petrov (@StanPetrov19) is the only player to have played in the Premier League whose name contains all the letters in the word 'Nativity'. Star.\n\nObviously, I have absolutely nothing against ['Big Stan'](https://en.wikipedia.org/wiki/Stiliyan_Petrov). He's a legend; a 'star', if you will. Captain of Aston Villa! Bulgaria! Battled leukaemia and still made it to nearly 600 games. One of the best Bulgarian/Premier League 'Petrovs', along with cult legend [Martin](https://en.wikipedia.org/wiki/Martin_Petrov).\n\nBut could this stat possibly be true? Surely there's at least one other player. Perhaps a window of opportunity for me to avenge my feelings of cringe?\n\nOh, and obviously you can ignore the candid dismissals in the tweet's replies, [for example](https://twitter.com/duke_smyles/status/1607052807680524289?s=20):\n\n> What are we supposed to do with this information? [Picture of wryly-smiling duck.]\n\nNo, this is more important than any Opta tweet ever: what if it's... _wrong_?\n\n# Stan in R, but not {rstan}\n\nSo I looked into it using R, of course. \n\nTurns out it's pretty straightforward with [the excellent {worldfootballR} package by Jason Zivkovic](https://jaseziv.github.io/worldfootballR/), which helps fetch player data from [Transfermarkt](https://www.transfermarkt.com/) (among other suppliers).\n\nBasically, we can fetch data about footballers from every team in a given league's season since its inception. So, aha, you cannot escape, Opta!\n\nMy little [{soccercolleagues} package](https://github.com/matt-dray/soccercolleagues) that [I wrote about in early 2022](https://www.rostrum.blog/2022/02/04/soccercolleagues/) is built heavily (heavily!) around {worldfootballR} and has a convenience function we can use.\n\nThe niche[^footballr] primary objective of {soccercolleagues} is to let you [find pairs of football players that were colleagues at some point](https://www.rostrum.blog/2022/02/04/soccercolleagues/). Like: 'which current Premier League footballer has been team mates with each of the following: Kevin Phillips, Mark Viduka, Dejan Lovren, Danny Ings and Nicky Butt?'[^boring]\n\nFollow along. As ever, you can install the {soccercolleagues} package from GitHub:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nif(!require(remotes)) install.packages(\"remotes\")\nremotes::install_github(\"matt-dray/soccercolleagues\")\n```\n:::\n\n\nWe'll also use the {tidyverse} for wrangling.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(soccercolleagues)\nlibrary(tidyverse)\n```\n:::\n\n\nSo we can ask Transfermarkt for all the years of the English Premier League, which began in 1992:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# This will take quite a long time...\nepl_players <- soccercolleagues::get_players(\n  seasons = 1992:2022,\n  country = \"England\"\n)\n```\n:::\n\n\nAnd now we can look for the players whose names contain the letters in 'nativity':\n\n\n::: {.cell}\n\n```{.r .cell-code}\nepl_players |>\n  distinct(player_name) |>\n  mutate(\n    player_name = str_remove_all(tolower(player_name), \" \"),\n    n_count = str_count(player_name, \"n\"),\n    a_count = str_count(player_name, \"a\"),\n    t_count = str_count(player_name, \"t\"),\n    i_count = str_count(player_name, \"i\"),\n    v_count = str_count(player_name, \"v\"),\n    y_count = str_count(player_name, \"y\")\n  ) |>\n  filter(\n    n_count >= 1 &\n      a_count >= 1 &\n      t_count >= 2 &\n      i_count >= 2 &\n      v_count >= 1 &\n      y_count >= 1\n  )\n## # A tibble: 1 × 7\n##   player_name    n_count a_count t_count i_count v_count y_count\n##   <chr>            <int>   <int>   <int>   <int>   <int>   <int>\n## 1 stiliyanpetrov       1       1       2       2       1       1\n```\n:::\n\n\nOof... they were right. He is the only one.\n\nWow, this humble pie is so delicious, thank you so much Opta for unintentionally spoonfeeding it to me.\n\nTo be clear: Opta's data analysts have a good track record, as far as I know. But I've got my eye on you! You'll slip up one day!\n\n...But wait. Opta were misnaming Stan as 'Stylian Petrov' [in tweets as late as 2012](https://twitter.com/OptaJoe/status/169439820584714240?s=20). Get rekt! You missed the extra 'i' you need in 'nativity', fools! Put respect on Stiliyan's name!\n\n'Result'.[^score]\n\n\n---\n<details><summary>Session info</summary>\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n─ Session info ───────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.2.0 (2022-04-22)\n os       macOS Big Sur/Monterey 10.16\n system   x86_64, darwin17.0\n ui       X11\n language (EN)\n collate  en_US.UTF-8\n ctype    en_US.UTF-8\n tz       Europe/London\n date     2023-04-10\n pandoc   2.19.2 @ /Applications/RStudio.app/Contents/Resources/app/quarto/bin/tools/ (via rmarkdown)\n\n─ Packages ───────────────────────────────────────────────────────────────────\n package     * version date (UTC) lib source\n cli           3.6.0   2023-01-09 [1] CRAN (R 4.2.0)\n digest        0.6.31  2022-12-11 [1] CRAN (R 4.2.0)\n evaluate      0.20    2023-01-17 [1] CRAN (R 4.2.0)\n fastmap       1.1.0   2021-01-25 [1] CRAN (R 4.2.0)\n htmltools     0.5.2   2021-08-25 [1] CRAN (R 4.2.0)\n htmlwidgets   1.5.4   2021-09-08 [1] CRAN (R 4.2.0)\n jsonlite      1.8.4   2022-12-06 [1] CRAN (R 4.2.0)\n knitr         1.42    2023-01-25 [1] CRAN (R 4.2.0)\n rlang         1.0.6   2022-09-24 [1] CRAN (R 4.2.0)\n rmarkdown     2.14    2022-04-25 [1] CRAN (R 4.2.0)\n rstudioapi    0.14    2022-08-22 [1] CRAN (R 4.2.0)\n sessioninfo   1.2.2   2021-12-06 [1] CRAN (R 4.2.0)\n xfun          0.37    2023-01-31 [1] CRAN (R 4.2.0)\n yaml          2.3.7   2023-01-23 [1] CRAN (R 4.2.0)\n\n [1] /Library/Frameworks/R.framework/Versions/4.2/Resources/library\n\n──────────────────────────────────────────────────────────────────────────────\n```\n:::\n:::\n</details>\n\n[^sponsor]: This post is not guerilla marketing for Opta. It would be _extremely_ guerilla if they wanted to advertise on _this_ blog.\n[^footballr]: There is definitely a burgeoning crossover of football stats and R users, see [Ryo](https://ryo-n7.github.io/), [Ben](https://torvaney.github.io/) and [Tony](https://tonyelhabr.rbind.io/), for example.\n[^boring]: Hint: it's a very 'boring' footballer, lol.\n[^score]: By which I mean I lost 1-0.",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}