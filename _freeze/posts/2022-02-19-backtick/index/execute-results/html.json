{
  "hash": "f33ae3b25143cc6923c6b64a09cd819b",
  "result": {
    "markdown": "---\ntitle: Add in an RStudio Addin to add in backticks\ndate: 2022-02-19\nslug: backtick\ncategories:\n  - backtick\n  - blogsnip\n  - r\n  - rstudio-addin\n  - rstudioapi\n  - snorkel\n---\n\n\n![](resources/backtick.gif){fig-alt=\"Gif of RStudio script pane. An RStudio addin called backtick is being used to insert a single backtick, surround selected text with bacticks, surround selected text with backticks as inline R code, and surround selected text with an R code chunk.\" width=\"100%\"}\n\n## tl;dr\n\nI wrote [a tiny R package called {backtick}](https://github.com/matt-dray/backtick), which contains an RStudio Addin with a handful of functions for inserting backticks into your R scripts and R Markdown documents (yes, really).\n\n## Plus one\n\n[RStudio Addins](https://rstudio.github.io/rstudioaddins/) let you select an R function from a dropdown menu in the RStudio IDE. They're often functions that you don't need in your executed script, but can make your life easier by performing some kind of supportive action.\n\nFor example, you can use the RStudio Addin in [the {remedy} package from ThinkR](https://thinkr-open.github.io/remedy/) to add Markdown formatting to your text. [RStudio's {reprex} package](https://reprex.tidyverse.org/) has a built-in RStudio Addin to create a reproducible example from highlighted code. Or [how about Miles McBain's {datapasta} Addin](https://milesmcbain.github.io/datapasta/index.html) for pasting conveniently into R scripts from external sources?\n\nYou can find many more examples in [Dean Attali's {addinslist} package](https://github.com/daattali/addinslist), which itself contains an Addin for... adding more Addins.\n\n## In addition\n\nI've written about RStudio Addins before. \n\nI have [a GitHub-hosted package called {blogsnip}](https://github.com/matt-dray/blogsnip) with an Addin to help me insert code into these blogposts.[^serdar] For example, to insert the session-information block at the end of each post, or to insert HTML to create more accessible images.\n\n{blogsnip} also hosts a concept function [to add a comment to each closing bracket with the name of the function being closed](https://www.rostrum.blog/2021/08/31/add-biscuits/). I've found it useful for keeping on top of deeply-nested Shiny apps.\n\nA while back I also [wrote an Addin](https://www.rostrum.blog/2020/11/14/hello-r2eng/) for [the {r2eng} package](https://matt-dray.github.io/r2eng/) to let your computer speak R code aloud as an English sentence.\n\nI also recently created [the {snorkel} R package](https://github.com/matt-dray/snorkel), which contains an Addin to help you insert {roxygen2} formatting to your function documentation. Turns out [Jozef wrote a detailed series about how you can do something similar](https://jozef.io/r102-addin-roxytags/).\n\n![You put a snorkel in your mouth to help you breathe oxygen; you put a {snorkel} in your addins to help you write with {roxygen2}.](resources/snorkel.gif){fig-alt=\"Gif of RStudio Addin being used to add roxygen2 tags to selected text in the documentation for a function. Addins used are: format as bold, link to function in another package, and make hyperlink.\" width=\"100%\"}\n\nI wanted to write something about how to quickly set up a package to insert or replace text, which I think is probably the most common (simple) use of RStudio Addins. \n\nEventually [I was nerdsniped (unintentionally) on Twitter by Calum](https://twitter.com/ShinyBlackShoe/status/1494987656924737537?s=20&t=OxfNuCkFsR7TfZCkt6DlHg) to do something about it.\n\n## The problem\n\nProblem: Calum's backtick key, <kbd>`</kbd>, is [being used to activate additional software](https://twitter.com/ShinyBlackShoe/status/1494987656924737537?s=20&t=52-4AXxnjPvSEnTHUsRamg) that's awkward to toggle on and off every time they wanted to use the backtick for R coding.[^nut]\n\nTo solve Calum's problem ([and Italy's?](https://commons.wikimedia.org/wiki/File:Italian_Keyboard_layout.svg)[^italy]), you could try to use [a custom keyboard shortcut](https://t.co/JxZuhfbl2P), or maybe [a snippet](https://t.co/aZakMQ3Nvu). And RStudio already has a button and shortcut in its IDE for inserting R Markdown code chunks, which require triple backticks to demarcate the start and end of the chunk.\n\nBut an RStudio Addin is another viable method that means you can bundle up a set of functions that insert each of the backtick 'constructions', from a single backtick to an R Markdown chunk. \n\nAs a bonus, you can also set the functions of an Addin to [custom keyboard shortcuts](https://support.rstudio.com/hc/en-us/articles/206382178-Customizing-Keyboard-Shortcuts-in-the-RStudio-IDE) and quickly access them from [the RStudio command palette](https://www.rstudio.com/blog/rstudio-v1-4-preview-command-palette/) (just hit <kbd>Shift</kbd> + <kbd>Cmd</kbd> + <kbd>P</kbd>, or <kbd>Shift</kbd> + <kbd>Ctrl</kbd> + <kbd>P</kbd>, then type the word 'backtick').\n\n## A solution\n\nSo, the (very specific!) user need was clear and I created [the {backtick} package](https://github.com/matt-dray/backtick) with functions to: \n\n* insert a single backtick (i.e. <code>`</code>)\n* surround selected text with single backticks (i.e. `selection` becomes `` `selection` ``)\n* surround selected text with backticks for execution as inline R code in an R Markdown document (as above, but inserts an `r` and space after the first backtick)\n* surround selected text with backticks for execution as an R code chunk in an R Markdown document (`selection` is surrounded by `` ```{r} `` above and `` ``` `` below)\n\nThat last one is especially neat because the in-built RStudio function doesn't appear to put selected text inside an R Markdown chunk; it simply inserts the skeleton of a chunk.\n\n[Calum notes that this solution worked](https://twitter.com/ShinyBlackShoe/status/1495096159957880834?s=20&t=52-4AXxnjPvSEnTHUsRamg), and that they were able to set the insert backtick Addin to the keyboard shortcut <kbd>Alt</kbd> + <kbd>`</kbd>, lol.\n\n## Add your own\n\nI wanted to record for posterity how you (and me) can create this sort of thing.\n\n1. First, create a new package---I like to use `usethis::create_package()`---and complete basic things like the DESCRIPTION file ([I wrote about this before](https://www.rostrum.blog/2019/11/01/usethis/))\n1. [Write functions in an R script](https://github.com/matt-dray/backtick/blob/main/R/backticks.R)---I like to use `usethis::use_r()` to create this script in the package---that insert code or replace selected text using [the {rstudioapi} package](https://rstudio.github.io/rstudio-extensions/pkgdown/rstudioapi/index.html))\n1. Add [an `inst/rstudio/addins.dcf` file](https://github.com/matt-dray/backtick/blob/main/inst/rstudio/addins.dcf)[^dcf] that declares each of your Addins\n\nPoints 2 and 3 are in scope for this quick post.\n\n### Use {rstudioapi}\n\nWhat do I mean by 'write functions that insert or replace' text?\n\nWell, insertion is straightforward. Here's [the function definition from {backtick}](https://github.com/matt-dray/backtick/blob/main/R/backticks.R) to insert a single backtick:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbt_backtick <- function() {\n  rstudioapi::insertText(\"`\")\n}\n```\n:::\n\n\nIn other words, it's as simple as a function that contains `rstudioapi::insertText()`. This fetches information from the IDE to know where the cursor is placed in your script, which is where a supplied text string (a single backtick in this case) will be inserted.\n\nAnd what about text replacement? A similar story: the {rstudioapi} package is used to detect the selected text, which can then be pasted together with other strings to produce and insert a new compound string. Here's [an example from {backtick}](https://github.com/matt-dray/backtick/blob/main/R/backticks.R) for surrounding selected text with backticks:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbt_backticks <- function() {\n\n  active_doc <- rstudioapi::getSourceEditorContext()\n\n  if (!is.null(active_doc)) {\n\n    selected_text <- active_doc$selection[[1]]$text\n\n    text_replace <- paste0(\"`\", selected_text, \"`\")\n\n    rstudioapi::modifyRange(\n      active_doc$selection[[1]]$range,\n      text_replace\n    )\n\n  }\n\n}\n```\n:::\n\n\nSo, in short, `rstudioapi::getSourceEditorContext()` fetches information about the script pane, including the current `selection`. That selection can be pasted with other strings, such as a backtick character at the start and end, and then inserted back into the script pane with `rstudioapi::modifyRange()` to replace the original selection.\n\nAnd, well... that's it for functions. All you need to do now is create a special text file so that the functions can be interpreted as Addins.\n\n### Create a dcf\n\nSo, for example, the `bt_bactick()` function can be exposed as an Addin function by adding the following to [the `inst/rstudio/addins.dcf` file](https://github.com/matt-dray/backtick/blob/main/inst/rstudio/addins.dcf):\n\n```\nName: Insert Backtick\nDescription: Insert a single backtick. In R Markdown file, one backtick will be\n    inserted. RStudio automatically adds a second backtick when this function is\n    used in an R script.\nBinding: bt_backtick\nInteractive: false\n```\n\nThis is pretty straightforward: you provide a name (which will be the name you see in the RStudio Addins dropdown menu) and a description (I just copied the description I wrote for the function documentation), along with the binding (just the function name). There's also 'interactive', which tells RStudio if it needs to wait for the user to do something (no, or `false` in our example).\n\n## Addintional resources\n\nThis was a quick roundup to help you (and me) remember quickly how to create this kind of simple insert/replace type of RStudio Addin.\n\nI recommend you check out a number of more in-depth resources:\n\n* [Sharon's excellent video 'Write your own RStudio addins'](https://www.infoworld.com/article/3336059/do-more-with-r-write-your-own-rstudio-addins.html)\n* [Jozef's in-depth blog series](https://jozef.io/r101-addin-reproducibility/)\n* [RStudio's very own introduction](https://rstudio.github.io/rstudioaddins/)\n\nLet me know about other useful Addins or tutorials for making them.\n\nAnd perhaps begin lobbying the Italian government to a backtick key on their keyboards as a gesture of solidarity with developers.\n\n## Environment {.appendix}\n\n<details><summary>Session info</summary>\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nLast rendered: 2023-07-02 15:51:47 BST\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nR version 4.3.1 (2023-06-16)\nPlatform: aarch64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.2.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/London\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nloaded via a namespace (and not attached):\n [1] htmlwidgets_1.6.2 compiler_4.3.1    fastmap_1.1.1     cli_3.6.1        \n [5] tools_4.3.1       htmltools_0.5.5   rstudioapi_0.14   yaml_2.3.7       \n [9] rmarkdown_2.22    knitr_1.43.1      jsonlite_1.8.5    xfun_0.39        \n[13] digest_0.6.31     rlang_1.1.1       evaluate_0.21    \n```\n:::\n:::\n\n</details>\n\n[^serdar]: Shout-out to Serdar, who has contributed functions to {blogsnip}!\n[^dcf]: 'Debian Control File' if you must know, but it doesn't really matter. A package DESCRIPTION file is also a type of dcf file, I believe.\n[^nut]: Ideally this would be fixed upstream. Re-map the other software to another key? Easier said than done if it's a work computer you're using. Turn off the other software when you're not using it? But what if you forget to switch it back on? Etc, etc. Relax, this is just a silly blog post. There must be [a relevant xkcd](https://xkcd.com/) though: why fix the real problem when you can write more software to paper the cracks?\n[^italy]: [Confirmed by a real-life Italian (as far as I can tell)!](https://twitter.com/alearrigo/status/1495306360560439298?s=20&t=h6HXxEG0rTzuDiCQ5z49Ng)\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}