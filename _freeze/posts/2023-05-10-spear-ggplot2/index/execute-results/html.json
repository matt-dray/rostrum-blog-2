{
  "hash": "5dee7d7d9e50db082c0ba03f9acb735c",
  "result": {
    "markdown": "---\ntitle: \"Recreating a dataviz with {ggplot2}\"\ndate: 2023-05-10\nslug: spear-ggplot2\ncategories:\n  - data-viz\n  - history\n  - ggplot2\n  - r\n---\n\n\n\n\n![They're the same picture. Nearly.](resources/corporate.png){fig-alt=\"The Office meme that says 'corporate needs you to find the difference between these two pictures. A crudely copy-pasted image of an original data visualisation by Mary Eleanor Spear is on the left and a recreation of it is on the right. They look pretty similar.\" width=\"100%\"}\n\n## tl;dr\n\nTwo years ago I won [a data-viz recreation competition run by the Royal Statistical Society](https://rss.org.uk/news-publication/news-publications/2021/general-news/cottonviz-data-visualisation-challenge-winners-ann/) (RSS) using base R's plotting. I wrote a short {ggplot2} how-to for RSS's 'Significance' magazine that was never published[^sig], so here it is now.\n\n## Recreate\n\nThis short code walkthrough will get you started on recreating [Mary Eleanor Spear](https://en.wikipedia.org/wiki/Mary_Eleanor_Spear)’s cotton plot (1952), as used in [the Royal Statistical Society's #CottonViz challenge](https://rss.org.uk/news-publication/news-publications/2021/general-news/cottonviz-data-visualisation-challenge-winners-ann/). We'll concentrate on the line chart for now.\n\n![](resources/spear.jpg){fig-alt=\"Mary Eleanor Spear's original plot of cotton supplies in 1940s USA. On the left is a line plot showing that carry-over stocks fell from 1942 to 1948, while consumption dropped slightly and exports rose slightly. A bar plot to the right shows the same data as a stacked bar chart. There are titles and captions around the plots.\" width=\"100%\"}\n\n[The {ggplot2} package in R](https://ggplot2.tidyverse.org/) is a good choice, since we can build up the chart in steps: first, we’ll build a basic line chart, remove unneeded elements, fix the axes and finally add the labels. It won’t look perfectly like Spear’s original, but we’ll get close.\n\nThis isn’t a guide to learn {ggplot2}, so you may want to [learn the basics first](https://r4ds.had.co.nz/data-visualisation.html). Alternatively, [I wrote a blog post](https://www.rostrum.blog/2021/06/08/recreate-spear/) about building Spear’s entire visualisation using base R only.\n\n## Requirements\n\nFirst, some preparation. If you haven’t already, install the [{ggplot2}](https://ggplot2.tidyverse.org/) package for plotting, [{tidyr}](https://tidyr.tidyverse.org/) data reshaping and [{extrafont}](https://github.com/wch/extrafont) for font handling.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"ggplot2\", \"tidyr\", \"extrafont\")\n```\n:::\n\n\nYou can download for free [the Routed Gothic font by Darren Embry](https://webonastick.com/fonts/routed-gothic/), which is a good approximation of the stencil lettering used by Spear. Installation will depend on your system, but in macOS you can simply drag the font files to the Font Book app. When you attach {extrafont} it’ll fetch automatically your installed fonts (including Routhed Gothic) so you can use them in R.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(extrafont)\n```\n:::\n\n\n## Tidying up\n\nThe cotton dataset is quite small, so we can create the dataframe ourselves. It provides information on the supply of cotton in the USA in the 1940s.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncotton_raw <- data.frame(\n  year           = 1942:1948,\n  us_consumption = c(11160, 9993,  9693,  9423,  10072, 9374,  7833),\n  exports        = c(1480,  1139,  2007,  3613,  3545,  1968,  4785),\n  stocks         = c(10657, 10744, 11164, 7326,  2530,  3080,  5283),\n  total_supply   = c(23297, 21876, 22864, 20362, 16147, 14422, 17901)\n)\n```\n:::\n\n\nIt’s preferable to make the data ‘tidy’ so that there’s one row per year and consumption type, and one column for each variable. The {tidyr} package can help us pivot the data to ‘long’ format from this ‘wide’ format.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyr)\n\ncotton <- cotton_raw %>% \n  pivot_longer(\n    c(us_consumption, exports, stocks), \n    names_to = \"consumption_type\", values_to = \"boles\"\n  )\n\nhead(cotton, 4)  # preview first few rows\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 4\n   year total_supply consumption_type boles\n  <int>        <dbl> <chr>            <dbl>\n1  1942        23297 us_consumption   11160\n2  1942        23297 exports           1480\n3  1942        23297 stocks           10657\n4  1943        21876 us_consumption    9993\n```\n:::\n:::\n\n\n## How-to\n\n### Step 1: line chart\n\nNow we can create a basic line chart of the data with `geom_line()` and set with `scale_linetype_manual()` a unique dashed line per group. Further arguments set the title and the typeface to be used throughout the plot, while a small tweak to `theme()` adjusts the title’s position.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\np1 <- ggplot() +\n  geom_line(\n    data = cotton,\n    aes(x = year, y = boles / 1000, linetype = consumption_type),\n    linewidth = 1.5\n  ) +\n  scale_linetype_manual(values = c(\"longdash\", \"dashed\", \"solid\")) +\n  labs(title = \"Millions of Boles\") +\n  theme(\n    plot.title = element_text(hjust = -0.05),\n    text = element_text(family = \"Routed Gothic\")\n  )\n\np1\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot-start-1.png){width=480}\n:::\n:::\n\n\n### Step 2: remove features\n\nLet’s clear away the unneeded features: the background panel, the axes titles and the legend. You can empty these with `element_blank()` in the `theme()` function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np2 <- p1 + \n  theme(\n    panel.background = element_blank(),\n    axis.title = element_blank(),\n    legend.position = \"none\"\n  )\n\np2\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot-theme-1.png){width=480}\n:::\n:::\n\n\n### Step 3: correct the axes\n\nNow we can address the axes. Use the `scale_*_continuous()` functions to set the axes values, limits, origin and labels. With `sec.axis` you can create a secondary y-axis that mirrors the first, then remove the tick labels in the `theme()` function. You can also put a box around the chart area with the `panel.border` argument.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np3 <- p2 +\n  scale_x_continuous(\n    breaks = seq(1942, 1948, 1),\n    labels = c(\"1942\", paste0(\"'\", 43:48)),\n    expand = c(0, 0)\n  ) +\n  scale_y_continuous(\n    breaks = seq(0, 12, 2),\n    limits = c(0, 12),\n    expand = c(0, 0),\n    sec.axis = dup_axis()\n  ) +\n  theme(\n    axis.ticks = element_line(linewidth = c(0, rep(0.5, 5), 0)),\n    axis.ticks.length = unit(-0.5, \"lines\"),\n    axis.text.y.right = element_blank(),\n    panel.border = element_rect(fill = NA, linewidth = 1)\n  )\n\np3\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot-axes-1.png){width=480}\n:::\n:::\n\n\n### Step 4: labels\n\nThe only missing features are the labels and arrows, which can be added with the `annotate()` and `geom_segment()`, respectively. A bit of trial-and-error will help you find the correct coordinates to place these elements.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np4 <- p3 +\n  annotate(\n    geom = \"text\",\n    x = c(1946.1, 1945.9, 1943.75),\n    y = c(10.8, 7.1, 3.2),\n    label = c(\"U. S. Consumption\", \"Carry – over\\nStocks\", \"Exports\"),\n    family = \"Routed Gothic\"\n  ) +\n  geom_segment(\n    aes(\n      x = c(1945.2, 1945.3, 1944.2),\n      y = c(10.5, 7.4, 3.1),\n      xend = c(1945, 1945.1, 1944.4), \n      yend = c(9.7, 7.1, 2.8)\n    ),\n    arrow = arrow(\n      length = unit(2, \"mm\"),\n      type = \"closed\"\n    )\n  )\n\np4\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot-segments-1.png){width=480}\n:::\n:::\n\n\n## Next steps\n\nFinally we’ve got a lineplot that looks pretty close to Spear’s visualisation. What subtle differences do you notice, though? Try to find ways to improve them.\n\nNext, try to recreate the stacked-barchart from Spear’s original and then arrange the plots with a main title and surrounding text labels. [The {ggpattern} package](https://coolbutuseless.github.io/package/ggpattern/index.html) may help you recreate the hatchlines on the bars and [{patchwork}](https://patchwork.data-imaginist.com/) could help with the arrangement of the plot and text elements.\n\n## Full base R alternative\n\nFor the original challenge I used only base R's plotting system rather than {ggplot2}. This is what my submitted image looked like:\n\n![](resources/recreation.png){fig-alt=\"The recreated plot in progress: the recreation is complete, with both the line and bar plots completed and the titles and captions added.\" width=\"100%\"}\n\nYou can read more about it in [the accompanying blog post](https://www.rostrum.blog/2021/06/08/recreate-spear/) and you can find [the original code on GitHub](https://github.com/matt-dray/viz-recreation/tree/main/2021-06-08_cottonviz_spear).\n\n## Environment {.appendix}\n\n<details><summary>Session info</summary>\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nLast rendered: 2023-07-06 19:27:43 BST\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nR version 4.3.1 (2023-06-16)\nPlatform: aarch64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.2.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/London\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n[1] ggplot2_3.4.2 tidyr_1.3.0  \n\nloaded via a namespace (and not attached):\n [1] vctrs_0.6.3       cli_3.6.1         knitr_1.43.1      rlang_1.1.1      \n [5] xfun_0.39         purrr_1.0.1       generics_0.1.3    jsonlite_1.8.7   \n [9] labeling_0.4.2    glue_1.6.2        colorspace_2.1-0  htmltools_0.5.5  \n[13] scales_1.2.1      fansi_1.0.4       rmarkdown_2.23    grid_4.3.1       \n[17] munsell_0.5.0     evaluate_0.21     tibble_3.2.1      fastmap_1.1.1    \n[21] yaml_2.3.7        lifecycle_1.0.3   compiler_4.3.1    dplyr_1.1.2      \n[25] htmlwidgets_1.6.2 pkgconfig_2.0.3   rstudioapi_0.14   farver_2.1.1     \n[29] digest_0.6.31     R6_2.5.1          tidyselect_1.2.0  utf8_1.2.3       \n[33] pillar_1.9.0      magrittr_2.0.3    gtable_0.3.3      tools_4.3.1      \n[37] withr_2.5.0      \n```\n:::\n:::\n\n</details>\n\n[^sig]: At least I don't think so. I can't find it by searching on the website, anyway. Also, enough time has passed that certain bits of the original code have since been deprecated in {ggplot2}, lol.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}