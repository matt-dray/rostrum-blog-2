{
  "hash": "dd9baa04cab6c086ddd0d97daadb22cd",
  "result": {
    "markdown": "---\ntitle: \"Dependency-free hex stickers with {hexbase}\"\ndate: 2025-01-31\nslug: \"hexbase\"\nimage: resources/demo-hex.png\ncategories:\n  - grid\n  - gex\n  - r\n---\n\n\n![Graphic design is my passion.](resources/demo-hex.png){fig-align=\"left\" fig-alt=\"A bisque-coloured hexagon with a hotpink border. The R logo is above centre and tilted at a jaunty angle. The text 'example' writtenin Comic Sans and is copied and shifted to give the effect of a shadow, red on black. On the lower-right edge in blue papyrus font is the text 'visit rostrum.blog ftw'.\" width='33%'}\n\n## tl;dr\n\nI've made [{hexbase}](https://github.com/matt-dray/hexbase), a simple package to create hex stickers in R. The twist: it relies only on base R.\n\n<div class=\"tip\"> \n`<svg aria-hidden=\"true\" role=\"img\" viewBox=\"0 0 512 512\" style=\"height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;\"><path d=\"M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zm0-384c13.3 0 24 10.7 24 24V264c0 13.3-10.7 24-24 24s-24-10.7-24-24V152c0-13.3 10.7-24 24-24zM224 352a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z\"/></svg>`{=html} <b>Note</b>\n\nThe package has been renamed to {gex} (loosely 'grid' + 'hex') and is now, ahem, 'dependency-light' to take advantage of other 'gridverse' packages (grid-graphics expansion packages made by Prof Murrell and others). The API for {gex} has also been updated relative to the version of {hexbase} shown in this post.\n\n</div>\n\n## Stick around\n\nHex stickers are obviously popular in the R community [and beyond](http://hexb.in/) for advertising your package or other projects[^examples]. So much so that there are packages to [organise your stickers](http://hexsession.liomys.mx/).\n\nThere's some existing tools to help you make these:\n\n* [{hexSticker}](https://github.com/GuangchuangYu/hexSticker) by Guangchuang Yu\n* [{bunny}](https://github.com/dmi3kno/bunny) by Dmytro Perepolkin, used in conjunction with {magick}\n* the [hexmake Shiny app](https://github.com/ColinFay/hexmake)[^login] by Colin Fay\n\nSurprise, I've made another one: [{hexbase}](https://github.com/matt-dray/hexbase). Why? I wanted to learn about low-level plotting with [{grid}](https://www.stat.auckland.ac.nz/~paul/grid/grid.html), one of R's built-in packages[^slaps]. The constraint of using only {grid} in a simple, lightweight package seemed a good test (and a good wheeze).\n\nIt's not perfect, but it does what I need and I learnt a lot.\n\n## Do the griddy\n\nI reckon most R users make plots with [{ggplot2}](https://ggplot2.tidyverse.org/) otherwise R's native `plot()`ting system. I'll bet {grid}[^ggplot] is used less often. It's lower-level and you have to build everything up yourself, but it is extremely flexible. \n\nTo put it extremely simply, {grid} mostly works through a system of nested 'viewports' that you push and pop to add and arrange various graphics objects (grobs[^grob]) onto a graphics device. \n\nThis post isn't a how-to for {grid} because there's too much to cover, though I might write a separate post to explain how {hexbase} uses {grid}. I found [Prof Paul Murrell](https://www.stat.auckland.ac.nz/~paul/grid/grid.html)'s writings really helpful, which is no surprise as Paul is {grid}'s author. See also [Roger's chapter](https://bookdown.org/rdpeng/RProgDA/the-grid-package.html) for an intro.\n\nHowever, I did learn a few things I wanted to note to myself:\n\n* the `grDevices::png()` function has a handy `bg` argument that you can set to `\"transparent\"`\n* you can clip to a grob, which means you could clip out any text or image that falls outside the hexagon boundary\n* you can rotate a viewport but the x and y coordinates will be relative to the angle, so you need to put it inside another viewport that's relative to the sticker's coordinates\n* the hexagon is not as wide as it is tall, so the x-axis on the default 'normalised parent coordinate' system (where the axes are 0 to 1) has to be narrowed by setting the viewport's `xscale` to hexagon limits, while the hexagon grob must have `default.units = \"native\"` so it's placed relative to that `xscale`\n* you can make the border by stacking a smaller hexagin on a bigger one, ensuring that the maximum extent of the sticker will fit inside a unit-1 square\n\n## Cast a hex\n\nIf you want to give it a go, you can install {hexbase} [from GitHub](https://github.com/matt-dray/hexbase) like:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"remotes\")  # if not yet installed\nremotes::install_github(\"matt-dray/hexbase\")\n```\n:::\n\n\nAt time of writing, the package is at version 0.1.0. You can install that specific version by adding `@v0.1.0` to the end of the string in `install_github()`.\n\nAs mentioned, the package only imports {grid} and {grDevices} from base R. Otherwise it's BYOIAF ('bring your own images and fonts') by importing with packages like {png} and by installing your fonts locally. Is that cheating? Nah, the `Imports` section in [the `DESCRIPTION` file](https://github.com/matt-dray/hexbase/blob/main/DESCRIPTION) is clean as far as I'm concerned!\n\nYou can then build a sticker additively with a series of {hexbase} function calls:\n\n1. `open_device()` to set up a PNG graphics device with the dimensions of [the Stickers Standard](https://sticker.how/#type-hexagon).\n1. `add_hex()` to add the hexagon and border.\n1. `add_image()` to place an image (run multiple times for more images).\n1. `add_text()` to place and style text (run multiple times for more text).\n1. `close_device()` to close the PNG graphics device and save to file.\n\nYou can set various text and image properties like position, size, colour and angle. Note that the coordinates are relative to a unit square[^square] with axes of 0 to 1, a lower-left origin at [0, 0] and a centre at [0.5, 0.5]. Text and images will be clipped if they exceed the boundary of the hexagon. Check the help files for all the explanation. \n\nBelow is an extremely basic example to demonstrate a number of features. Note how you call each function independently (i.e. no pipes), much like writing base plots with successive calls to `plot()`, `points()`, `text()`, etc.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Somewhere to save it\ntemp_path <- tempfile(fileext = \".png\")\n\n# 'Bring your own image', e.g. with {png}\nimage_path <- system.file(\"img\", \"Rlogo.png\", package = \"png\")\nimage_png <- png::readPNG(image_path)\n\n# Build up and write the sticker\nhexbase::open_device(  # open with sticker-standard dimensions\n  file_path = temp_path\n)\nhexbase::add_hex(\n  border_width = 0.06,\n  border_col = \"hotpink3\",\n  bg_col = \"bisque\"\n)\nhexbase::add_image(\n  image_object = image_png,\n  image_y = 0.6,  # y = 0.5 is centre\n  image_angle = 20,\n  image_width = 0.5  # i.e. half of the npc coord system\n)\nhexbase::add_text(\n  text_string = \"example\",\n  text_x = 0.495,\n  text_y = 0.35,\n  text_col = \"#000000\",  # named colour or hexadecimal\n  text_family = \"Comic Sans MS\",  # must be installed locally\n  text_face = \"bold\"  # or 'plain', 'italic', 'bold.italic'\n)\nhexbase::add_text(  # add multiple text/images (in a loop?)\n  text_string = \"example\",\n  text_x = 0.505,\n  text_y = 0.34,\n  text_col = \"red\",\n  text_family = \"Comic Sans MS\",\n  text_face = \"bold\"\n)\nhexbase::add_text(\n  text_string = \"visit rostrum.blog ftw\",\n  text_x = 0.73, \n  text_y = 0.18,\n  text_angle = 30,  # rotate to match lower-right edge\n  text_size = 5,  # point size\n  text_col = \"blue\", \n  text_family = \"Papyrus\"\n)\nhexbase::close_device()  # close viewports, write file\n```\n:::\n\n\nYou can then open the image for inspection. A quick way to do this from within R would be like `system(paste(\"open\", temp_path))`. Note that you can't rely on plot-window previews (they lie) when you're developing your sticker. You must inspect the generated PNG file instead.\n\nThe (stunning) hex produced by this code can be found at the top of this post. Well done for being able to read this far after you burnt your eyes by looking at it.\n\n## Don't get too hexcited\n\nI might play around with this a bit more if I have time and if I want to delve deeper into {grid}. The {hexbase} package seems to work for my use-case, but it can undoubtedly be improved. [Let me know](https://github.com/matt-dray/hexbase/issues) if there's anything you can unstick. I'd be hexstatic, etc.\n\n### Environment {.appendix}\n\n<details><summary>Session info</summary>\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nLast rendered: 2025-10-10 19:22:01 BST\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nR version 4.5.1 (2025-06-13)\nPlatform: aarch64-apple-darwin20\nRunning under: macOS Sequoia 15.6.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.1\n\nlocale:\n[1] en_GB.UTF-8/en_GB.UTF-8/en_GB.UTF-8/C/en_GB.UTF-8/en_GB.UTF-8\n\ntime zone: Europe/London\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nloaded via a namespace (and not attached):\n [1] htmlwidgets_1.6.4 compiler_4.5.1    fastmap_1.2.0     cli_3.6.5        \n [5] tools_4.5.1       htmltools_0.5.8.1 yaml_2.3.10       rmarkdown_2.29   \n [9] knitr_1.50        jsonlite_2.0.0    xfun_0.52         digest_0.6.37    \n[13] rlang_1.1.6       fontawesome_0.5.3 evaluate_1.0.4   \n```\n:::\n:::\n\n</details>\n\n[^examples]: I've [made a few](https://github.com/matt-dray/stickers) myself.\n[^login]: There seems to be [a problem with accessing the app](https://github.com/ColinFay/hexmake/issues/22) at time of writing.\n[^slaps]: [Base slaps](https://www.rostrum.blog/posts/2023-10-17-nhs-r-2023/), as they say.\n[^ggplot]: Though {grid} actually underpins {ggplot2}, so {ggplot2} extension-writers will be familiar.\n[^grob]: I swear this is the name of a _Magic: The Gathering_ creature or something.\n[^square]: Well, the initial plotting area is a unit-1 square, but the width of the hexagon is less than 1 on this scale, so two slivers are removed from the left and right of the hexagon. You can get the vertex point locations of the hexagon with the unexported `hexbase:::.get_hex_coords(diameter = 1)` function.",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}