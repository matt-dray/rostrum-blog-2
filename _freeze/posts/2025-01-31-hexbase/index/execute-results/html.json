{
  "hash": "107649a1c06b841ee3ae879477a668e2",
  "result": {
    "markdown": "---\ntitle: \"Dependency-free hex stickers with {hexbase}\"\ndate: 2024-12-15\nslug: \"hexbase\"\nimage: resources/demo-hex.png\ncategories:\n  - grid\n  - hexbase\n  - r\n---\n\n\n![Graphic design is my passion.](resources/demo-hex.png){fig-align=\"left\" fig-alt=\"A bisque-coloured hexagon with a hotpink border. The R logo is above centre and tilted at a jaunty angle. The text 'example' writtenin Comic Sans and is copied and shifted to give the effect of a shadow, red on black. On the lower-right edge in blue papyrus font is the text 'visit https://rstats.lol ftw'.\" width='50%'}\n\n## tl;dr\n\nI've made [{hexbase}](https://github.com/matt-dray/hexbase), a simple package to create hex stickers in R. The twist: it relies only on base R packages.\n\n## Stick around\n\nHex stickers are obviously popular in the R community[^hexbin] for advertising your package or other projects[^examples].\n\nThere's some existing tools to help you make these:\n\n* [{hexSticker}](https://github.com/GuangchuangYu/hexSticker) by Guangchuang Yu\n* the [hexmake Shiny app](https://github.com/ColinFay/hexmake)[^login] by Colin Fay\n* [{bunny}](https://github.com/dmi3kno/bunny) by Dmytro Perepolkin, used in conjunction with {magick}\n\nSurprise, I've made another one: [{hexbase}](https://github.com/matt-dray/hexbase). Why? I wanted to learn about low-level plotting with [{grid}](https://www.stat.auckland.ac.nz/~paul/grid/grid.html), one of R's built-in packages[^slaps]. The constraint of using _only_ {grid} in a simple, lightweight sticker-making package seemed a good exemplar (and a good wheeze).\n\nI don't know if it's actually any good, but I learnt a lot.\n\n## Do the griddy\n\nI reckon most R users make plots with [{ggplot2}](https://ggplot2.tidyverse.org/) otherwise R's native `plot()`ting system. I'll bet {grid}[^ggplot] is used less often. It's much lower-level and you have to build everything up yourself, but it is extremely flexible. \n\nTo put it extremely simply, {grid} mostly works through a system of nested 'viewports' that you push and pop to add and arrange various graphics objects (grobs[^grob]) onto a graphics device. \n\nThis post isn't about {grid} because there's too much to cover. I found [Paul Murrell](https://www.stat.auckland.ac.nz/~paul/grid/grid.html)'s writings really helpful, which is no surprise as Paul is {grid}'s author. See also [Roger's chapter](https://bookdown.org/rdpeng/RProgDA/the-grid-package.html) for an intro.\n\nHowever, I did learn a few things I wanted to note to myself:\n\n* you can rotate a viewport but the x and y coordinates will be relative to the angle, so you need to put it inside another viewport that's relative to the sticker's coordindates\n* you can clip to a grob, which means you could clip out any text or image that falls outside the hexagon boundary\n* the `grDevices::png()` function has a handy `bg` argument that you can set to `\"transparent\"`\n* the default grid coordinate system is 'normalised parent coordinates' (0 to 1 on both axes), but the hexagon is not as wide as it is tall, so the `xscale` of the parent viewport can be set to the min and max width of the hexagon, while the `default.units` of the hexagon grobs can be set to `\"native\"`\n\n## Cast a hex\n\nYou could install {hexbase} [from GitHub](https://github.com/matt-dray/hexbase) like:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"remotes\")  # if not yet installed\nremotes::install_github(\"matt-dray/hexbase\")\n```\n:::\n\n\nAs mentioned, the package only imports {grid} and {grDevices} from base R. Otherwise it's BYOIAF ('bring your own images and fonts') by importing with packages like {png} and by installing your fonts locally. Is that cheating? Nah, the `Imports` section in the `DESCRIPTION` file is clean as far as I'm concerned!\n\nYou can then build a sticker additively with a series of function calls:\n\n1. `open_device()` to set up a PNG graphics device with the dimensions of [the Stickers Standard](https://sticker.how/#type-hexagon).\n1. `add_hex()` to add the hexagon and border.\n1. `add_image()` to place an image (run multiple times for more images).\n1. `add_text()` to place and style text (run multiple times for more text).\n1. `close_device()` to close the PNG graphics device and save to file.\n\nYou can set various text and image properties like position, size, colour and angle. Text and images will be clipped if they exceed the boundary of the hexagon. Check the help files for all the explanation. \n\nBelow is an extremely basic example. Note how you call each function independently (i.e. no pipes), much like writing base plots with successive calls to `plot()`, `points()`, `text()`, etc.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Somewhere to save it\ntemp_path <- tempfile(fileext = \".png\")\n\n# 'Bring your own image'\nimage_path <- system.file(\"img\", \"Rlogo.png\", package = \"png\")\nimage_png <- png::readPNG(image_path)\n\n# Build up and write the sticker\nhexbase::open_device(file_path = temp_path)\nhexbase::add_hex(\n  border_width = 0.06,\n  border_col = \"hotpink3\",\n  bg_col = \"bisque\"\n)\nhexbase::add_image(\n  image_object = image_png,\n  image_y = 0.6,  # y = 0.5 is centre\n  image_angle = 20,\n  image_width = 0.5\n)\nhexbase::add_text(\n  text_string = \"example\",\n  text_x = 0.495,\n  text_y = 0.35,\n  text_col = \"#000000\",  # named or hex\n  text_family = \"Comic Sans MS\",  # must be installed locally\n  text_face = \"bold\"\n)\nhexbase::add_text(  # add multiple texts/images\n  text_string = \"example\",\n  text_x = 0.505,\n  text_y = 0.34,\n  text_col = \"red\",\n  text_family = \"Comic Sans MS\",\n  text_face = \"bold\"\n)\nhexbase::add_text(\n  text_string = \"visit https://rstats.lol ftw\",\n  text_x = 0.73, \n  text_y = 0.18,\n  text_angle = 30, \n  text_size = 5, \n  text_col = \"blue\", \n  text_family = \"Papyrus\"\n)\nhexbase::close_device()\n```\n:::\n\n\nYou can then open the image for inspection. A quick way to do this from within R would be like `system(paste(\"open\", temp_path))`. Note that you can't rely on plot-window previews (they lie) when you're developing your sticker. You must inspect the generated PNG file instead.\n\nThe (stunning) hex produced by this code can be found at the top of this post. Well done for being able to read this far after you burnt your eyes by looking at it.\n\n## Don't get too hexcited\n\nI might play around with this a bit more if I have time and if I want to delve deeper into {grid}. The {hexbase} package seems to work for my use-case, but it can undoubtedly be improved. [Let me know](https://github.com/matt-dray/hexbase/issues) if there's anything you can unstick. I'd be hexstatic, etc.\n\n### Environment {.appendix}\n\n<details><summary>Session info</summary>\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nLast rendered: 2025-01-31 23:40:34 GMT\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nR version 4.4.2 (2024-10-31)\nPlatform: aarch64-apple-darwin20\nRunning under: macOS Ventura 13.2.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/London\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nloaded via a namespace (and not attached):\n [1] htmlwidgets_1.6.4 compiler_4.4.2    fastmap_1.2.0     cli_3.6.3.9000   \n [5] tools_4.4.2       htmltools_0.5.8.1 rstudioapi_0.16.0 yaml_2.3.10      \n [9] rmarkdown_2.28    knitr_1.48        jsonlite_1.8.9    xfun_0.48        \n[13] digest_0.6.37     rlang_1.1.4       evaluate_1.0.1   \n```\n:::\n:::\n\n</details>\n\n[^examples]: I've [made a few](https://github.com/matt-dray/stickers) myself.\n[^hexbin]: And beyond, if you take a look at [hexb.in](http://hexb.in/).\n[^slaps]: [Base slaps](https://www.rostrum.blog/posts/2023-10-17-nhs-r-2023/), as they say.\n[^ggplot]: Though {grid} actually underpins {ggplot2}, so {ggplot2} extension-writers will be familiar.\n[^grob]: I swear this is the name of a _Magic_ creature or something.\n[^login]: At time of writing, the app seems to need a login, oddly.",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}