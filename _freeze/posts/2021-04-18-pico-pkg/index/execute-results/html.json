{
  "hash": "f9e7375a6a84d784da234e6f46a55593",
  "result": {
    "markdown": "---\ntitle: 'Make the simplest R package with {pico}'\ndate: 2021-04-18\nslug: pico-pkg\ncategories:\n  - pico\n  - r\n  - usethis\n---\n\n\n\n\n![](resources/pico_hex.png){fig-alt=\"Hexagonal logo for the pico package with the package name in very small font in light brown on a darker brown background.\" width=\"25%\"}\n\n## tl;dr\n\nI made [{pico}](https://github.com/matt-dray/pico), an R package for creating tiny R packages with the absolute minimum structure and content. The goal: to demystify package making.\n\n## Function in a haystack\n\nI saw [a \\@WeAreRLadies tweet](https://twitter.com/WeAreRLadies/status/1383135972926296064) from last week's curator, [\\@ShreyaLouis](https://twitter.com/ShreyaLouis). The gist was 'how can you be more organised when recalling and reusing your own R code?'\n\nSee [the thread](https://twitter.com/WeAreRLadies/status/1383135972926296064) for ideas, but I had [the same thought as Fabio](https://twitter.com/favstats/status/1383138145491943425?s=20): create a personal package of your frequently-used functions so you can invoke them whenever you want.[^onetweet]\n\n## What's the problem?\n\n[Packages are daunting](https://twitter.com/WeAreRLadies/status/1383142336050384896?s=20), particularly if you haven't made one before. I've [written a number of packages for fun and learning](https://github.com/matt-dray/projects/blob/main/README.md#-r-packages), but none have been [submitted to CRAN](https://cran.r-project.org/) and I'm never quite sure if I'm doing everything 'correctly'.\n\nFrom personal experience, I think the esoteric structure and content of R packages are a barrier to beginners. Like, what is the `man/` folder and what's an `.Rd` file? It's easy to look at a chonky package repo on GitHub, like the popular [{dplyr}](https://github.com/tidyverse/dplyr/), and despair.\n\nYes, you could RTFM ('Read the Hecking Manual') about R packages, but have you [looked at it](http://www.hep.by/gnu/r-patched/r-exts/R-exts.html#SEC_Top) before? And it's not even necessary to follow all of these steps if you don't have dreams of submitting it to CRAN.\n\nWhat if---for teaching purposes---we strip back to the absolute barest of requirements with the goal of demystifying packages and to make it easier to get started?\n\n## Minimalism\n\nWhat's the least we need for a functioning package? Well, following [Karl Broman's book](http://kbroman.org/pkg_primer/pages/minimal.html), all you need is two files and a subfolder. That is all.\n\nHere's how it looks for an imaginary package called {mypkg}:\n\n```\nmypkg/\n├── R/\n│   └── functions.R\n└── DESCRIPTION\n```\n\nThe `mypkg/R/functions.R` file is a normal R script where you put your function definitions, like:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsay_hi <- function(name = \"buddy\") {\n  paste0(\"Ahoy-hoy \", name, \"!\")\n}\n```\n:::\n\n\nThe `DESCRIPTION` file (which has no file extension) might not be as familiar, but it's basically a text file with only two lines: the package name and a version number (typically 0.0.0.9000 indicates a package under development, whereas 0.1 might be a minor release).[^version]\n\n```\nPackage: mypkg\nVersion: 0.0.0.9000\n```\n\nThe `DESCRIPTION` file is like a magic flag that identifies that this folder is special and contains an R package; it isn't just a boring folder with some R scripts in it.\n\n...And that's all you need.\n\n## Introducing {pico}\n\nSo, you could point-and-click to create a folder with the structure and content outlined above, but I've also created [the {pico} package](https://github.com/matt-dray/pico) to make the setup even easier.[^yo]\n\nThe basic process for using {pico} is:\n\n1. Install {pico} with `remotes::install_github(\"matt-dray/pico\")`\n1. Create your package with e.g. `pico::create(\"mypkg\", \"~/Documents/\")` (the second argument is a filepath for where to put the package folder)\n1. Add new function definitions to the `mypkg/R/functions.R` script file\n1. Install the package to your computer with `remotes::install_local(\"~/Documents/mypkg\")` and attach it like a normal package with `library(mypkg)`\n\nLater you can add more functions to `R/functions.R` (or add more script files to the `R/` folder) and can reinstall the package with `install_local()`, using the `force = TRUE` argument to overwrite the old version.\n\nLet's take a look at those steps in a bit more depth.\n\n### Install {pico}\n\nFirst, you can install {pico} [from GitHub](https://github.com/matt-dray/pico) with help from the {remotes} package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"remotes\")  # if not yet installed\nremotes::install_github(\"matt-dray/pico\")\n```\n:::\n\n\nYou can look up the help files with `?pico::create()` at any time.\n\nIt's a really small package, but let me know if you [find any bugs](https://github.com/matt-dray/pico/issues) or you want to contribute.\n\n### Create your package\n\nThere's only one function in {pico}: `create()`. It generates a folder with the minimum required content, as outlined above. You supply a package `name` and a `dir`ectory (folder on your computer) where you want your package to be generated.\n\nAs a demonstration, here’s how to create a pico package called {mypkg} in [a temporary folder](https://en.wikipedia.org/wiki/Temporary_folder). You should put yours somewhere more permanent and convenient like `~/Documents` on macOS, for example.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmp <- tempdir()\npico::create(name = \"mypkg\", dir = tmp)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nPico package {mypkg} written to:\n  /var/folders/cg/5x7y2f0x6tqb9mqrc13pd8_40000gn/T//RtmpRGhTOc/mypkg\n```\n:::\n:::\n\n\nThis will output some lines in the R console that confirm your new package has been written to the location you specified (my example path here is convoluted because it's just a temporary folder).\n\nThe `name` will be checked against R-package naming standards: it should contain alphanumeric characters or periods only, must have at least two characters, and can't start with a number nor end with a period. The provided `dir`ectory also will be checked for existence and, if it already contains a folder with the proposed name of your package, you’ll be asked interactively if you want to overwrite it.\n\n### Install your package\n\nSo, the package now exists on your computer inside a folder. Now how do you use its functions in an R session?\n\nNormally, you would use `install.packages()` to fetch a package from CRAN and install it to your computer's R package library. We can do something similar, but instead of fetching from CRAN, we can fetch the package 'locally', i.e. from your computer.\n\nTo do this, we can use the {remotes} package, which we installed earlier. It contains an `install_local()` function to which you pass the package’s filepath on your computer.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nremotes::install_local(\n  path = file.path(tmp, \"mypkg\")  # change to your packages filepath\n)\n```\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n✓  checking for file  ‘private/var/folders/cg/5x7y2f0x6tqb9mqrc13pd8_40000gn/T//RtmpRGhTOc/mypkg ’ ...\n ─  preparing ‘mypkg’:\n ✓  checking DESCRIPTION meta-information\n ─  checking for LF line-endings in source and make files and shell scripts\n ─  checking for empty or unneeded directories\n ─  creating default NAMESPACE file\n ─  building ‘mypkg_0.0.9000.tar.gz’\n \n * installing *source* package ‘mypkg’ ...\n ** using staged installation\n ** R\n ** byte-compile and prepare package for lazy loading\n ** help\n No man pages found in package  ‘mypkg’ \n *** installing help indices\n ** building package indices\n ** testing if installed package can be loaded from temporary location\n ** testing if installed package can be loaded from final location\n ** testing if installed package keeps a record of temporary installation path\n * DONE (mypkg)\n```\n:::\n:::\n\n\nYou'll see some output that describes the installation process, ending with `DONE`.\n\nThe package is now installed into your R package library and can be attached like any other package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(mypkg)\n```\n:::\n\n\nNow the functions from the package are available for use. By default, `create()` added a dummy function called `say_hi()` to `R/functions.R`, which we can use now:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsay_hi(\"chums\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Ahoy-hoy chums!\"\n```\n:::\n:::\n\n\nSo, we created an R package, installed it and used it.\n\n## Add new functions\n\nOf course, you'll want to add your own functions to your package. The basic steps are:\n\n1. Open the `R/functions.R` script\n1. Paste in your function definitions and save the file\n1. Rerun `remotes::install_local()` with the argument `force = TRUE`\n1. Restart R, so the updated package is recognised\n\nHere's what this might look like for our example package. First, you might add the function `say_bye()` by adding these lines to the `functions.R` file:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsay_bye <- function(name = \"folks\") {\n  paste0(\"Cheerio \", name, \"!\")\n}\n```\n:::\n\n\nAfter you saved the updated file, you can re-run `install_local()` with the file path and `force = TRUE`, which will overwrite the old version in the package library.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nremotes::install_local(\n path = file.path(tmp, \"mypkg\"),\n force = TRUE\n)\n```\n:::\n\n\nYou must restart R after you've done this.\n\nYour new functions will then be available from your package, much like the dummy `say_hi()` function was. Here's `say_bye()`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(mypkg)\nsay_bye(\"friends\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Cheerio friends!\"\n```\n:::\n:::\n\n\nSo, that means that all those functions you keep forgetting, or that are stored across multiple locations, can be made available to you from one package. And ultimately, all it required was `install_github()`, `create()` and `install_local()`.\n\nNote that it can get unwieldy to add all your functions to the `functions.R` file provided by {pico}, but you can group them up into several R scripts in the `R/` subfolder if you like.\n\n## Huge limitations\n\nSo, I think {pico} is a quick way to get you from 'no-package' to 'package' quickly, but more importantly it has none of the esoteric, daunting structure and content of a 'normal' package.\n\nHowever.\n\nA pico package doesn't encourage best practice, nor is it very useful for sharing. That's why I think the only practical applications are for learning the basics of package structure, or for building a small package of functions that you might personally want to use again in future.\n\nI would absolutely advocate for learning how to make a 'real' package, because that additional structure and content is really powerful and exists for a reason. For example, we haven't documented any of our functions. What if you add a function to your package but you can't remember how to use it? We also haven't tested anything. What if something breaks?\n\nI've [written before about the wonders of {usethis}](https://www.rostrum.blog/2019/11/01/usethis/), a package made specifically to help develop your own R packages without thinking too hard. I believe it provides the perfect starting point for developing your own package without worrying about exactly what files are needed and where.\n\nThere's a vast array of free web-based resources out there for package building. For example, some that I've found useful are:\n\n* [Hilary Parker’s _Writing an R Package from Scratch_ post](https://hilaryparker.com/2014/04/29/writing-an-r-package-from-scratch/)\n* [Tom Westlake’s update to Hilary’s post](https://r-mageddon.netlify.com/post/writing-an-r-package-from-scratch/)\n* [Fabio Votta's fun slides](https://develop-rpkgs.netlify.app/)\n* [Emil Hvitfeldt’s {usethis} workflow](https://www.hvitfeldt.me/blog/usethis-workflow-for-package-development/)\n* [Karl Broman’s _R Package Primer_ site](https://kbroman.org/pkg_primer/), a primer for package development\n* [Hadley Wickham’s _R Packages_ book](http://r-pkgs.had.co.nz/)\n\nYou should make use of those resources, for sure. Do not use {pico} for any serious work. {pico}'s purpose here is to think about how we might demystify package development. At worst I think it's an interesting curiosity.\n\n## Environment {.appendix}\n\n<details><summary>Session info</summary>\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nLast rendered: 2023-07-16 13:41:04 BST\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nR version 4.3.1 (2023-06-16)\nPlatform: aarch64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.2.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/London\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n[1] mypkg_0.0.9000\n\nloaded via a namespace (and not attached):\n [1] desc_1.4.2        digest_0.6.31     R6_2.5.1          fastmap_1.1.1    \n [5] xfun_0.39         remotes_2.4.2     knitr_1.43.1      htmltools_0.5.5  \n [9] rmarkdown_2.23    ps_1.7.5          cli_3.6.1         processx_3.8.1   \n[13] callr_3.7.3       pico_0.0.0.9000   compiler_4.3.1    rprojroot_2.0.3  \n[17] prettyunits_1.1.1 rstudioapi_0.15.0 tools_4.3.1       pkgbuild_1.4.1   \n[21] evaluate_0.21     yaml_2.3.7        crayon_1.5.2      rlang_1.1.1      \n[25] jsonlite_1.8.7    htmlwidgets_1.6.2\n```\n:::\n:::\n\n</details>\n\n\n\n\n\n[^onetweet]: My initial thought was to try and respond---in a single tweet---with the code required to build a package. That might help show how little code is required, especially with shortcuts like `usethis::create_package()` and `usethis::use_r()`. But I think there's a little too much extra explanation required for this to be a viable, helpful response.\n[^version]: You don't need to worry too much about the version number for now, especially if you aren't releasing the package to the world. You can read more [in Hadley's book](https://r-pkgs.org/description.html#version), though.\n[^yo]: Yo, I heard you like packages that make packages, so I wrote you a package to make a package.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}