<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.176">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Matt Dray">
<meta name="dcterms.date" content="2021-08-10">

<title>rostrum.blog (test) - Read a hex colour code with {dehex}</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/logo-black-trans.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "keyboard-shortcut": [
    null
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/logo-green-trans.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">rostrum.blog (test)</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target=""><i class="bi bi-question-circle-fill" role="img">
</i> 
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../index.xml" rel="" target=""><i class="bi bi-rss-fill" role="img" aria-label="RSS feed">
</i> 
 <span class="menu-text">RSS</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/matt-dray/rostrum-blog-2" rel="" target=""><i class="bi bi-github" role="img" aria-label="GitHub source code">
</i> 
 <span class="menu-text">Source</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Read a hex colour code with {dehex}</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://www.matt-dray.com">Matt Dray</a> </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 10, 2021</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#tldr" id="toc-tldr" class="nav-link active" data-scroll-target="#tldr">tl;dr</a></li>
  <li><a href="#hue-are-you" id="toc-hue-are-you" class="nav-link" data-scroll-target="#hue-are-you">Hue are you?</a></li>
  <li><a href="#the-desandro-method" id="toc-the-desandro-method" class="nav-link" data-scroll-target="#the-desandro-method">The DeSandro Method</a></li>
  <li><a href="#introducing-dehex" id="toc-introducing-dehex" class="nav-link" data-scroll-target="#introducing-dehex">Introducing {dehex}</a>
  <ul class="collapse">
  <li><a href="#cheat-codes" id="toc-cheat-codes" class="nav-link" data-scroll-target="#cheat-codes">Cheat codes</a></li>
  <li><a href="#learning-is-fun" id="toc-learning-is-fun" class="nav-link" data-scroll-target="#learning-is-fun">Learning is fun</a></li>
  <li><a href="#test-yourself" id="toc-test-yourself" class="nav-link" data-scroll-target="#test-yourself">Test yourself</a></li>
  </ul></li>
  <li><a href="#dream-of-colourfornication" id="toc-dream-of-colourfornication" class="nav-link" data-scroll-target="#dream-of-colourfornication">Dream of colourfornication</a></li>
  
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p><img src="resources/graph-crayon-dark.png" class="img-fluid" style="width:100.0%" alt="Output from the dehex package's dh_graph function, which shows a horizontal bar chart in the RStudio console with a dark theme. The columns are labelled R, G, B, S and L and the ends of the RGB columns are labelled H1, H2 and H3. The RGB bars are coloured red, blue and green; S and L are white. Above the plot is the three-digit colour hex code that graph is summarising."></p>
<section id="tldr" class="level2">
<h2 class="anchored" data-anchor-id="tldr">tl;dr</h2>
<p>I wrote <a href="https://github.com/matt-dray/dehex">an R package, {dehex}</a>, that helps you learn to ‘read’ a hex colour code by eye according to David DeSandro’s method. <a href="https://metafizzy.co/blog/read-color-hex-codes/">Check out his mindblowing talk</a>.</p>
</section>
<section id="hue-are-you" class="level2">
<h2 class="anchored" data-anchor-id="hue-are-you">Hue are you?</h2>
<p><a href="https://en.wikipedia.org/wiki/Web_colors">Hex codes</a> are used in computing to encode a colour as a succinct six-digit alphanumeric string, like #F4D82A.</p>
<p>These codes are written in hexadecimal (hence ‘hex’): they can take the characters 0 to 9 and A to F, which encodes 16 possible values. This encodes 16 million colours total, which are easy for computers to store and interpret.</p>
<p>Each pair of characters basically encodes red, green and blue. For example, the code #FF000 is ‘red’. It uses the highest of these hex values, ‘F’, in both of the ‘red’ positions, while the green and blue pairs are zero.</p>
<p>That’s easy enough to decipher, but what about #8ACD52 or #C0FFEE?<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> You could copy these into a tool that returns colour information (many search engines can do this now) but they often return a sample and not the colour’s name.</p>
<p>I’m red-green colourblind and have difficulty identifying and talking about colours, so that’s not always helpful.</p>
</section>
<section id="the-desandro-method" class="level2">
<h2 class="anchored" data-anchor-id="the-desandro-method">The DeSandro Method</h2>
<p><a href="https://desandro.com/">David DeSandro</a> of <a href="https://metafizzy.co/">Metafizzy</a> gave <a href="https://metafizzy.co/blog/read-color-hex-codes/">a talk at the dotCSS conference in 2018</a> about his superpower: ‘reading’ a hex colour code by eye.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<p><a href="https://www.youtube.com/watch?v=eqZqx6lRPe0">His talk</a> is comprehensive and has excellent visuals. I strongly recommend that you watch his explanation if you find this topic interesting. You can also find <a href="https://speakerdeck.com/desandro/read-color-hex-codes">the slides</a> and <a href="https://metafizzy.co/blog/read-color-hex-codes/">a great written explanation on his blog</a>. I cannot do justice here to such a powerful thought technology.</p>
<p>In short, it’s possible to look at a hex code like #F2D359 and get the rough <a href="https://en.wikipedia.org/wiki/HSL_and_HSV">hue, saturation and lightness</a> of the colour it encodes, which you can speak as an English phrase like ‘light washed yellow’. David, too, is colourblind and has found success with his method.</p>
<p>This post isn’t about colour theory and I’m definitely not an expert, but the point of the method is that you don’t need to be one.</p>
</section>
<section id="introducing-dehex" class="level2">
<h2 class="anchored" data-anchor-id="introducing-dehex">Introducing {dehex}</h2>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="resources/dehex-logo.png" class="img-fluid figure-img" style="width:30.0%" alt="A hexagon-shaped logo with the text 'dehex' in the lower right and a bar chart with a single red, green and blue bar that originates in the top left."></p>
<figcaption class="figure-caption">This is a hex logo, but it has a white background.</figcaption>
</figure>
</div>
<p>Right, so I’ve made <a href="https://github.com/matt-dray/dehex">a small R package called {dehex}</a> that you can use to:</p>
<ol type="1">
<li>Train yourself to read hex codes with the DeSandro Method</li>
<li>Return a rough English phrase for a given hex code</li>
</ol>
<p>All from your R console.</p>
<p><a href="https://github.com/matt-dray/dehex">The package is on GitHub</a> and you can install with the help of {remotes}.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"matt-dray/dehex"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The reason for the name should be obvious: you’re ‘dehexing’, i.e.&nbsp;converting from hex. But also I like the connotation of removing a ‘hex’ as in a spell. The colour is cursed; it’s trapped behind a code.</p>
<p>Usual warnings: the package needs a refactor, there’s probably some bugs, but it works for me. <a href="https://github.com/matt-dray/dehex">Drop an issue or PR in the GitHub repo</a> with any ideas or suggestions.</p>
<section id="cheat-codes" class="level3">
<h3 class="anchored" data-anchor-id="cheat-codes">Cheat codes</h3>
<p>You are thinking:</p>
<blockquote class="blockquote">
<p>Ugh, this sounds like effort, just tell me what colour my hex code is</p>
</blockquote>
<p>So I’m going to show you immediately how to retrieve an English phrase and a colour sample for a given hex code. Probably this is the most useful bit of the package for users who don’t want to become a hex mentat.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<p>Since we’re ‘solving’ the hex code, the function is called <code>dh_solve()</code>.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> It outputs a text string.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>dehex<span class="sc">::</span><span class="fu">dh_solve</span>(<span class="st">"#F2D359"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "light washed yellow"</code></pre>
</div>
</div>
<p>If you set <code>swatch</code> to <code>TRUE</code>, then you’ll get a plot filled with that colour as well.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>dehex<span class="sc">::</span><span class="fu">dh_solve</span>(<span class="st">"#F2D359"</span>, <span class="at">swatch =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/colour-out-1.png" alt="A monochrome block coloured with a light washed yellow." width="400" height="200"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "light washed yellow"</code></pre>
</div>
</div>
<p>How lovely.</p>
<div class="tip">
<p>ℹ️ <b>Note</b></p>
<p>I later noticed that <a href="https://github.com/msanchez-beeckman/ColorNameR">the package {ColorNameR}</a> exists, which has the express purpose of taking a colour code and returning a name for that colour.</p>
</div>
</section>
<section id="learning-is-fun" class="level3">
<h3 class="anchored" data-anchor-id="learning-is-fun">Learning is fun</h3>
<p>For the more adventurous, you can use {dehex} to learn how to read a hex code with DeSandro’s method from your R console.</p>
<p>There’s <a href="https://speakerdeck.com/desandro/read-color-hex-codes?slide=10">five steps</a>:</p>
<ol type="1">
<li>Simplify from a six- to a three-digit hex code</li>
<li>Create a bar chart from the RGB values encoded by the short hex</li>
<li>Assess hue (red, orange, violet, etc) from the chart’s ‘shape’</li>
<li>Assess saturation (‘saturated’, ‘washed’, etc) from the range of the RGB values</li>
<li>Assess lightness (‘dark’, ‘middle’, ‘light’) from the total of the RGB values</li>
</ol>
<p>I’ve incorporated each of these into {dehex}, plus a method for getting the answer.</p>
<section id="three-digit-code" class="level4">
<h4 class="anchored" data-anchor-id="three-digit-code">1. Three-digit code</h4>
<p>Turns out that <a href="https://speakerdeck.com/desandro/read-color-hex-codes?slide=67">the first value of each pair is the important one</a> when determining colour, so you can shorten the standard six-digit hex code to just three digits.</p>
<p>That’s easy enough to do in your head, but the function <code>dh_shorten()</code> does it for you:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>hex_code <span class="ot">&lt;-</span> <span class="st">"#F2D359"</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>short_code <span class="ot">&lt;-</span> dehex<span class="sc">::</span><span class="fu">dh_shorten</span>(hex_code)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>short_code</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "#FD5"</code></pre>
</div>
</div>
<p>As it happens, the short code is still recognised by interpreters, but it’s often expanded double up each value to get back to six. So #FD5 is technically #FFDD55 rather than the original #F2D359, but that doesn’t really matter for our purposes.</p>
</section>
<section id="rgb-graph" class="level4">
<h4 class="anchored" data-anchor-id="rgb-graph">2. RGB graph</h4>
<p>The values in the shortcode encode an ‘amount’ of red, green and blue. The lowest value is 0 and the highest is F, which is hexadecimal for 15. The higher the value, the more that’s ‘mixed’ into the final colour.</p>
<p>You can use <code>dh_graph()</code> to create this for you automatically. Rather than generate a plot though, we can just print a cute bar graph to the console. We’re only using it for reference, after all.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>dehex<span class="sc">::</span><span class="fu">dh_graph</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  short_code,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">adorn_h =</span> <span class="cn">FALSE</span>, <span class="at">adorn_s =</span> <span class="cn">FALSE</span>, <span class="at">adorn_l =</span> <span class="cn">FALSE</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#FD5
R ████████████████
G ██████████████░░
B ██████░░░░░░░░░░</code></pre>
</div>
</div>
<p>For whatever reason, certain browsers struggle to render these graph outputs correctly in this blog post (seems fine in Firefox). In your console, the graphs will appear with neat ‘continuous’ bars instead of as individual blocks. Example in a dark theme editor:</p>
<p><img src="resources/dh-graph-correct.png" class="img-fluid" alt="Output from the dehex package's dh_graph function, which shows a horizontal bar chart in the RStudio console with a light theme. The columns are labelled R, G, and B and are coloured red, green and blue. Above the plot is the three-digit colour hex code that graph is summarising." width="200"></p>
<p>The output is a horizontal chart showing the values of red (R), green (G) and blue (B) encoded by the hex short code. Each bar is made from 16 <a href="https://en.wikipedia.org/wiki/Block_Elements">unicode block elements</a> (i.e.&nbsp;0 to 15), which are ‘filled’ to represent the amount of each colour.</p>
<p>If you’re using RStudio, this will print in colour, thanks to <a href="https://github.com/r-lib/crayon">the {crayon} package</a> (although you can turn it off with the argument <code>crayon = FALSE</code>). That looks like this using RStudio’s default light theme:</p>
<p><img src="resources/graph-crayon-light-no-adorn.png" class="img-fluid" alt="Output from the dehex package's dh_graph function, which shows a horizontal bar chart in the RStudio console with a light theme. The columns are labelled R, G, and B and are coloured red, green and blue. Above the plot is the three-digit colour hex code that graph is summarising." width="200"></p>
<p>Or, using a dark theme:</p>
<p><img src="resources/graph-crayon-dark-no-adorn.png" class="img-fluid" alt="Output from the dehex package's dh_graph function, which shows a horizontal bar chart in the RStudio console with a dark theme. The columns are labelled R, G, and B and are coloured red, green and blue. Above the plot is the three-digit colour hex code that graph is summarising." width="200"></p>
<p>Perhaps you’re wondering what the <code>adorn_*</code> arguments do in <code>dh_graph()</code>. They add extra information to the output that will help us in steps 3 to 5. I’ll switch these on as we go through those next steps.</p>
</section>
<section id="hue" class="level4">
<h4 class="anchored" data-anchor-id="hue">3. Hue</h4>
<p>For our purposes, <a href="https://en.wikipedia.org/wiki/Hue">hue</a> is basically a name we give a colour, like ‘orange’. We’re going to compare the ‘profile’ or ‘shape’ of our RGB graph to a number of others to determine which one most closely resembles ours.</p>
<p>For simplicity, we stick only to the primary, secondary and tertiary colours in <a href="https://en.wikipedia.org/wiki/RGB_color_model">the RGB colour system</a>: red, green and blue; yellow, cyan, magenta; orange, chartreuse, aquamarine, azure, violet and rose. We also include a special case: grey.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
<p>The {dehex} package has a built in guide that will print RGB graphs for each of these colours. Since this is a guide for hue, you pass the argument <code>"H"</code>. I’ve hidden the output, since there are 13 graphs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>dehex<span class="sc">::</span><span class="fu">dh_guide</span>(<span class="st">"H"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<details>
<summary>
Click to expand the hue guides
</summary>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>red
R ████████████████ H 3
G █░░░░░░░░░░░░░░░ H 1.5
B █░░░░░░░░░░░░░░░ H 1.5

green
R █░░░░░░░░░░░░░░░ H 1.5
G ████████████████ H 3
B █░░░░░░░░░░░░░░░ H 1.5

blue
R █░░░░░░░░░░░░░░░ H 1.5
G █░░░░░░░░░░░░░░░ H 1.5
B ████████████████ H 3

yellow
R ████████████████ H 2.5
G ████████████████ H 2.5
B █░░░░░░░░░░░░░░░ H 1

cyan
R █░░░░░░░░░░░░░░░ H 1
G ████████████████ H 2.5
B ████████████████ H 2.5

magenta
R ████████████████ H 2.5
G █░░░░░░░░░░░░░░░ H 1
B ████████████████ H 2.5

orange
R ████████████████ H 3
G █████████░░░░░░░ H 2
B █░░░░░░░░░░░░░░░ H 1

chartreuse
R █████████░░░░░░░ H 2
G ████████████████ H 3
B █░░░░░░░░░░░░░░░ H 1

aquamarine
R █░░░░░░░░░░░░░░░ H 1
G ████████████████ H 3
B █████████░░░░░░░ H 2

azure
R █░░░░░░░░░░░░░░░ H 1
G █████████░░░░░░░ H 2
B ████████████████ H 3

violet
R █████████░░░░░░░ H 2
G █░░░░░░░░░░░░░░░ H 1
B ████████████████ H 3

rose
R ████████████████ H 3
G █░░░░░░░░░░░░░░░ H 1
B █████████░░░░░░░ H 2

grey
R █████████░░░░░░░ H 2
G █████████░░░░░░░ H 2
B █████████░░░░░░░ H 2</code></pre>
</div>
</div>
</details>
<p>You can see that I’ve added a value to the end of each bar, which represents the ranking of the RGB values. This follows the logic of the <code>rank()</code> function in base R: 1 is smallest, 3 is largest and ties are the average of the shared ranks. However, I’ve increased the tolerance for ties.<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></p>
<p>Which of the graphs in the hue guide most closely resemble our colour?</p>
<p>You might be able to see by eye that it’s probably yellow, but we look at our graph again but this time with <code>adorn_h</code> set to <code>TRUE</code> (the default).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>dehex<span class="sc">::</span><span class="fu">dh_graph</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  short_code,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">adorn_h =</span> <span class="cn">TRUE</span>, <span class="at">adorn_s =</span> <span class="cn">FALSE</span>, <span class="at">adorn_l =</span> <span class="cn">FALSE</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#FD5
R ████████████████ H 2.5
G ██████████████░░ H 2.5
B ██████░░░░░░░░░░ H 1</code></pre>
</div>
</div>
<p>So, we have an RGB hue ranking of 2.5-2.5-1, which indeed matches the ‘yellow’ ranks in the guide, even if the RGB values are not exactly the same.</p>
<p>I admit this step is quite clunky and it doesn’t help that there’s so many plots to compare against. It’s easier I think when you have a colour wheel arrangement to look at, <a href="https://speakerdeck.com/desandro/read-color-hex-codes?slide=41">like in DeSandro’s talk</a>. Remember: with {dehex}’s help, you just need to look at the ranking values at the end of each bar.</p>
</section>
<section id="saturation" class="level4">
<h4 class="anchored" data-anchor-id="saturation">4. Saturation</h4>
<p>Now we repeat the process for <a href="https://en.wikipedia.org/wiki/Colorfulness">saturation</a>. This time we’re going to compare the range of RGB values. This is easier because there’s only three (<a href="https://speakerdeck.com/desandro/read-color-hex-codes?slide=50">‘saturated’, ‘washed’ and ‘muted’) plus grey (i.e.&nbsp;zero range)</a>.</p>
<p>This time we pass <code>"S"</code> for the saturation guide:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>dehex<span class="sc">::</span><span class="fu">dh_guide</span>(<span class="st">"S"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<details>
<summary>
Click to expand the saturation guides
</summary>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>saturated
R ████████████████
G █████████░░░░░░░
B █░░░░░░░░░░░░░░░
S ████████████████

washed
R █████████████░░░
G █████████░░░░░░░
B ████░░░░░░░░░░░░
S ░░░██████████░░░

muted
R ██████████░░░░░░
G █████████░░░░░░░
B ███████░░░░░░░░░
S ░░░░░░████░░░░░░

grey
R █████████░░░░░░░
G █████████░░░░░░░
B █████████░░░░░░░
S ░░░░░░░░█░░░░░░░</code></pre>
</div>
</div>
</details>
<p>This time there’s an additional bar for saturation, labelled ‘S’, that indicates the range of RGB values covered by each level of saturation. We can compare the saturation of our colour with the <code>adorn_s</code> argument set to <code>TRUE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>dehex<span class="sc">::</span><span class="fu">dh_graph</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  short_code,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">adorn_h =</span> <span class="cn">FALSE</span>, <span class="at">adorn_s =</span> <span class="cn">TRUE</span>, <span class="at">adorn_l =</span> <span class="cn">FALSE</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#FD5
R ████████████████
G ██████████████░░
B ██████░░░░░░░░░░
S ░░░░░███████████</code></pre>
</div>
</div>
<p>So, that’s roughly the range of the ‘washed’ category of saturation.</p>
</section>
<section id="lightness" class="level4">
<h4 class="anchored" data-anchor-id="lightness">5. Lightness</h4>
<p>Finally, we do the same for the <a href="https://en.wikipedia.org/wiki/Lightness">lightness</a> of the colour (<a href="https://speakerdeck.com/desandro/read-color-hex-codes?slide=46">‘light’, ‘middle’ and ‘dark’</a>. You can total up the values, where higher values are lighter, but I’ve chosen to mark the mean value in {dehex} because I think it’s easier to interpret from the graph format.</p>
<p>Provide <code>"L"</code> for lightness to the <code>dh_guide()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>dehex<span class="sc">::</span><span class="fu">dh_guide</span>(<span class="st">"L"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<details>
<summary>
Click to expand the lightness guides
</summary>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>light
R ████████████████
G ███████████████░
B ██████████████░░
L ░░░░░░░░░░░░░░█░

middle
R ██████████░░░░░░
G █████████░░░░░░░
B ████████░░░░░░░░
L ░░░░░░░░█░░░░░░░

dark
R ████░░░░░░░░░░░░
G ███░░░░░░░░░░░░░
B ██░░░░░░░░░░░░░░
L ░░█░░░░░░░░░░░░░</code></pre>
</div>
</div>
</details>
<p>And again, here’s the chart for our colour showing a column for lightness:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>dehex<span class="sc">::</span><span class="fu">dh_graph</span>(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  short_code,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">adorn_h =</span> <span class="cn">FALSE</span>, <span class="at">adorn_s =</span> <span class="cn">FALSE</span>, <span class="at">adorn_l =</span> <span class="cn">TRUE</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#FD5
R ████████████████
G ██████████████░░
B ██████░░░░░░░░░░
L ░░░░░░░░░░░█░░░░</code></pre>
</div>
</div>
<p>Yep, slightly on the higher end, so it’s a lighter colour.</p>
</section>
<section id="solution" class="level4">
<h4 class="anchored" data-anchor-id="solution">Solution</h4>
<p>If you followed these steps, you’ll have seen that #F2D359 is roughly ‘light washed yellow’.</p>
<p>So, {dehex} can therefore be used as a ‘training device’ to guide you through this process.</p>
<p>The idea is that you remember the hue shapes (relatively hard because there’s lots), the saturation ranges (i.e.&nbsp;wider range means more saturated) and lightness averages (i.e.&nbsp;higher is lighter) from the guides and compare your colour to those.</p>
<p>You can check your answer (or cheat, of course) by using <code>dh_solve()</code>. I showed this earlier in the post, but it also has the option to see all the matching charts for hue, saturation and lightness:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>dehex<span class="sc">::</span><span class="fu">dh_solve</span>(hex_code, <span class="at">graphs =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>input code: #FD5
R ████████████████ H 2.5
G ██████████████░░ H 2.5
B ██████░░░░░░░░░░ H 1
S ░░░░░███████████
L ░░░░░░░░░░░█░░░░

hue: yellow
R ████████████████ H 2.5
G ████████████████ H 2.5
B █░░░░░░░░░░░░░░░ H 1

saturation: washed
R █████████████░░░
G █████████░░░░░░░
B ████░░░░░░░░░░░░
S ░░░██████████░░░

lightness: light
R ████████████████
G ███████████████░
B ██████████████░░
L ░░░░░░░░░░░░░░█░</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "light washed yellow"</code></pre>
</div>
</div>
<p>Here you can see the selected guides that best matched the input.</p>
</section>
</section>
<section id="test-yourself" class="level3">
<h3 class="anchored" data-anchor-id="test-yourself">Test yourself</h3>
<p>If you’re really serious about this, you’ll want to practice with random hex codes, of course. Lucky for you I’ve included a function that will generate them.</p>
<p>See if you can work out what this colour is using the guides and method above and then check your answer in the details block below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2021</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>rando_hex <span class="ot">&lt;-</span> dehex<span class="sc">::</span><span class="fu">dh_random</span>()</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>rando_hex</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "#76EA7C"</code></pre>
</div>
</div>
<details>
<summary>
Click here for the solution
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>dehex<span class="sc">::</span><span class="fu">dh_solve</span>(rando_hex, <span class="at">swatch =</span> <span class="cn">TRUE</span>, <span class="at">graphs =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/random-solve-1.png" alt="A monochrome block coloured with a dark washed red" width="400" height="200"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>input code: #7E7
R ████████░░░░░░░░ H 1.5
G ███████████████░ H 3
B ████████░░░░░░░░ H 1.5
S ░░░░░░░████████░
L ░░░░░░░░░█░░░░░░

hue: green
R █░░░░░░░░░░░░░░░ H 1.5
G ████████████████ H 3
B █░░░░░░░░░░░░░░░ H 1.5

saturation: washed
R █████████████░░░
G █████████░░░░░░░
B ████░░░░░░░░░░░░
S ░░░██████████░░░

lightness: middle
R ██████████░░░░░░
G █████████░░░░░░░
B ████████░░░░░░░░
L ░░░░░░░░█░░░░░░░</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "middle washed green"</code></pre>
</div>
</div>
</details>
<p>Did you get it right?</p>
</section>
</section>
<section id="dream-of-colourfornication" class="level2">
<h2 class="anchored" data-anchor-id="dream-of-colourfornication">Dream of colourfornication</h2>
<p>As ever, this package and post are a Showerthought That Became Real (possible tagline for this blog); something to fill my free time.</p>
<p>At very least I’ve got a better idea of identifying hex-encoded colours without looking them up and getting confused when presented with an unnamed block of colour that my deuteronopic eyes can’t understand.</p>
<p>I’m <a href="https://github.com/matt-dray/dehex-challenge">developing a Shiny app</a> to make this more of an interactive tool that you can use without even needing access to R. I can’t promise it’ll be ready any time soon.</p>
<p>Anyway, go and <a href="https://metafizzy.co/blog/read-color-hex-codes/">watch/read David DeSandro’s materials</a> and do <a href="https://github.com/matt-dray/dehex">drop an issue or PR in the {dehex} GitHub repo</a> if you have any contributions.</p>
</section>



<div id="quarto-appendix" class="default"><section id="environment" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">Environment</h2><div class="quarto-appendix-contents">

<details>
<summary>
Session info
</summary>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Last rendered: 2023-07-08 21:43:48 BST</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.3.1 (2023-06-16)
Platform: aarch64-apple-darwin20 (64-bit)
Running under: macOS Ventura 13.2.1

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: Europe/London
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

loaded via a namespace (and not attached):
 [1] digest_0.6.31     fastmap_1.1.1     xfun_0.39         magrittr_2.0.3   
 [5] knitr_1.43.1      htmltools_0.5.5   rmarkdown_2.23    lifecycle_1.0.3  
 [9] cli_3.6.1         grid_4.3.1        vctrs_0.6.3       compiler_4.3.1   
[13] purrr_1.0.1       rstudioapi_0.14   tools_4.3.1       evaluate_0.21    
[17] yaml_2.3.7        dehex_0.1.2       crayon_1.5.2      rlang_1.1.1      
[21] jsonlite_1.8.7    htmlwidgets_1.6.2</code></pre>
</div>
</div>
</details>


</div></section><aside id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Yep, if you have 1 to 9 and A to F, you can ‘spell’ words with hex codes. See <a href="https://coolbutuseless.github.io/2021/07/30/introducing-colourmebad-find-pronounceable-colours-close-to-reference-colours/">mikefc’s {colourmebad} package</a> and <a href="https://github.com/mdsumner/hexwords">Michael Sumner’s {hexwords}</a>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>I only found about this talk because of <a href="https://twitter.com/ma_salmon/status/1420726230194794496?s=20">a tweet from Maëlle</a>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>I’m still waiting for the release of Villeneuve’s <em>Dune</em>.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>All the functions in the package are prefixed with <code>dh_</code>, as in ‘dehex’, for easier autocomplete.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>At time of writing, black and white will actually be returned as ‘dark’ and ‘light’ versions of grey.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>There’s just too few combinations of RGB that result in selection of the hues that contain a tie, like red. I’ve considered RGB values within two units of each other as being a tie. I haven’t tested this thoroughly.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</aside><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div id="quarto-reuse" class="quarto-appendix-contents"><div>CC BY-NC-SA 4.0</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    if (id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        for (let i = 0; i < 2; i++) {
          container.appendChild(note.children[i].cloneNode(true));
        }
        return container.innerHTML
      } else {
        return note.innerHTML;
      }
    } else {
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      try { hash = new URL(url).hash; } catch {}
      const id = hash.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note !== null) {
        try {
          const html = processXRef(id, note);
          instance.setContent(html);
        } finally {
          instance.enable();
          instance.show();
        }
      } else {
        // See if we can fetch this
        fetch(url.split('#')[0])
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.getElementById(id);
          if (note !== null) {
            const html = processXRef(id, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>