<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Matt Dray">
<meta name="dcterms.date" content="2021-07-31">

<title>rostrum.blog - OG emoji SVGs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/logo-green-trans.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/logo-green-trans.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">rostrum.blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target=""><i class="bi bi-question-circle-fill" role="img">
</i> 
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../index.xml" rel="" target=""><i class="bi bi-rss-fill" role="img" aria-label="RSS feed">
</i> 
 <span class="menu-text">RSS</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/matt-dray/rostrum-blog-2" rel="" target=""><i class="bi bi-github" role="img" aria-label="GitHub source code">
</i> 
 <span class="menu-text">Source</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">OG emoji SVGs</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">emoji</div>
                <div class="quarto-category">magick</div>
                <div class="quarto-category">png</div>
                <div class="quarto-category">polite</div>
                <div class="quarto-category">r</div>
                <div class="quarto-category">svg</div>
                <div class="quarto-category">webscrape</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://www.matt-dray.com">Matt Dray</a> </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">July 31, 2021</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p><img src="resources/emoji-grid.png" class="img-fluid" style="width:100.0%" alt="A 10 by 9 grid of pixelated emojis coloured with random rainbow colours. Examples include a cat face, a fax machine and thumbs up."></p>
<section id="tldr" class="level2">
<h2 class="anchored" data-anchor-id="tldr">tl;dr</h2>
<p>I <a href="https://github.com/matt-dray/og-emoji-svg">wrote code to produce SVG versions of the ‘first-ever’ emoji set</a>. Using R, I scraped <a href="https://blog.emojipedia.org/">Emojipedia</a> with the <a href="https://dmi3kno.github.io/polite/">{polite}</a> package and then handled images with <a href="https://cran.r-project.org/package=png">{png}</a>, <a href="https://docs.ropensci.org/magick/index.html">{magick}</a> and <a href="https://svglite.r-lib.org/reference/svglite.html">{svglite}</a>.</p>
</section>
<section id="important-archival-work" class="level2">
<h2 class="anchored" data-anchor-id="important-archival-work">Important archival work</h2>
<p>I posted recently on <a href="https://www.rostrum.blog/2021/06/28/pixel-art/">creating ‘pixel art’ in R</a> and have since stumbled upon <a href="https://coolbutuseless.github.io/2018/08/13/gganimate-with-sprites/">an old post by mikefc on the coolbutuseless blog</a> with a method that makes it easier to convert from an image to its ‘pixels’.</p>
<p>I’ve also learnt recently of <a href="https://emilhvitfeldt.github.io/emoji/">Emil’s development of the {emoji} package</a> for R (superseding <a href="https://github.com/hadley/emo">Hadley’s GitHub-only {emo} package</a>).</p>
<p>Speaking of emoji, <a href="https://en.wikipedia.org/wiki/Jeremy_Burge">Jeremy Burge</a> and colleagues have worked hard to archive and document them on <a href="https://blog.emojipedia.org/">Emojipedia</a>. They posted recently about the discovery that <a href="https://blog.emojipedia.org/correcting-the-record-on-the-first-emoji-set/">the first emoji set was likely to be from SoftBank in 1997</a>, rather than <a href="https://stories.moma.org/the-original-emoji-set-has-been-added-to-the-museum-of-modern-arts-collection-c6060e141f61">the NTT DOCOMO set that was acquired by MoMA</a>.</p>
<p>As a mash-up of these things, I’ve decided to create SVG versions of the original SoftBank set. This format means that the images can be resized without loss of resolution and can be adapted in other ways, like being recoloured.</p>
<p>The approach:</p>
<ol type="1">
<li>Scrape the Emojipedia hub page for SoftBank’s 1997 emojis</li>
<li>Scrape each emoji’s dedicated page to retrieve its image path</li>
<li>Download each image (gif format)</li>
<li>Convert gifs to PNGs to matrices</li>
<li>Convert matrices to plots to SVGs</li>
</ol>
<p>The packages we need are all available from CRAN with <code>install.packages()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(polite)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(rvest)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(purrr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(svglite)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(png)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(magick)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>All the code here is available in <a href="https://github.com/matt-dray/og-emoji-svg">a GitHub repo</a>.</p>
</section>
<section id="scrape-politely" class="level2">
<h2 class="anchored" data-anchor-id="scrape-politely">Scrape politely</h2>
<p>It’s best to scrape using <a href="https://dmi3kno.github.io/polite/">the {polite} package</a>, which allows you to identify yourself to the target website and observe any requests to delay between scrapes. I’ve <a href="https://www.rostrum.blog/2019/03/04/polite-webscrape/">written about this before</a>.</p>
<p>First we <code>bow()</code> to the site by providing our information and saying where we want to scrape. The returned object contains information that {polite} uses to decide whether scraping is allowed and whether a crawl delay is required.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>ep_bow <span class="ot">&lt;-</span> <span class="fu">bow</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">url =</span> <span class="st">"https://emojipedia.org/softbank/1997"</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">user_agent =</span> <span class="st">"M Dray &lt;https://www.matt-dray.com&gt;"</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>ep_bow</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;polite session&gt; https://emojipedia.org/softbank/1997
    User-agent: M Dray &lt;https://www.matt-dray.com&gt;
    robots.txt: 1 rules are defined for 1 bots
   Crawl delay: 5 sec
  The path is scrapable for this user-agent</code></pre>
</div>
</div>
<p>From <a href="https://emojipedia.org/softbank/1997/">the SoftBank 1997 hub page</a> of <a href="https://blog.emojipedia.org/">Emojipedia</a> we can scrape the URLs that lead to each emoji’s dedicated page. <a href="https://rvest.tidyverse.org/">The {rvest} package</a> has some handy functions that help us manipulate the retrieved HTML after scraping with {polite}, which rate-limits us to a retrieval every 5 seconds, given the information returned from our <code>bow()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>sb_urls <span class="ot">&lt;-</span> <span class="fu">scrape</span>(ep_bow) <span class="sc">|&gt;</span> <span class="fu">html_nodes</span>(<span class="st">"a"</span>) <span class="sc">|&gt;</span> <span class="fu">html_attr</span>(<span class="st">"href"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>sb97_urls <span class="ot">&lt;-</span> sb_urls[<span class="fu">grepl</span>(<span class="st">"/1997/"</span>, sb_urls) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"more"</span>, sb_urls)]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sb97_urls)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "/softbank/1997/grinning-face-with-big-eyes/"   
[2] "/softbank/1997/smiling-face-with-smiling-eyes/"
[3] "/softbank/1997/disappointed-face/"             
[4] "/softbank/1997/angry-face/"                    
[5] "/softbank/1997/pile-of-poo/"                   
[6] "/softbank/1997/kiss-mark/"                     </code></pre>
</div>
</div>
<p>From this we can get the full list of 90 emoji names for the 1997 SoftBank set.</p>
<details>
<summary>
Click to expand full list of emoji names
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">basename</span>(sb97_urls)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "grinning-face-with-big-eyes"    "smiling-face-with-smiling-eyes"
 [3] "disappointed-face"              "angry-face"                    
 [5] "pile-of-poo"                    "kiss-mark"                     
 [7] "broken-heart"                   "red-heart"                     
 [9] "raised-hand"                    "victory-hand"                  
[11] "index-pointing-up"              "thumbs-up"                     
[13] "raised-fist"                    "oncoming-fist"                 
[15] "boy"                            "girl"                          
[17] "man"                            "woman"                         
[19] "baby-angel"                     "person-surfing"                
[21] "dog-face"                       "cat-face"                      
[23] "tiger-face"                     "horse-face"                    
[25] "mouse-face"                     "bear"                          
[27] "penguin"                        "spouting-whale"                
[29] "fish"                           "cherry-blossom"                
[31] "rose"                           "shortcake"                     
[33] "hot-beverage"                   "cocktail-glass"                
[35] "beer-mug"                       "fork-and-knife"                
[37] "mount-fuji"                     "house"                         
[39] "office-building"                "church"                        
[41] "sunrise-over-mountains"         "railway-car"                   
[43] "bullet-train"                   "station"                       
[45] "automobile"                     "fuel-pump"                     
[47] "sailboat"                       "airplane"                      
[49] "twelve-oclock"                  "one-oclock"                    
[51] "two-oclocktime"                 "three-oclock"                  
[53] "four-oclock"                    "five-oclock"                   
[55] "six-oclock"                     "seven-oclock"                  
[57] "eight-oclock"                   "nine-oclock"                   
[59] "ten-oclock"                     "eleven-oclock"                 
[61] "crescent-moon"                  "sun"                           
[63] "cloud"                          "umbrella-with-rain-drops"      
[65] "snowman-without-snow"           "christmas-tree"                
[67] "soccer-ball"                    "baseball"                      
[69] "tennis"                         "flag-in-hole"                  
[71] "skis"                           "t-shirt"                       
[73] "running-shoe"                   "ring"                          
[75] "gem-stone"                      "musical-note"                  
[77] "microphone"                     "saxophone"                     
[79] "guitar"                         "trumpet"                       
[81] "mobile-phone"                   "telephone"                     
[83] "fax-machine"                    "laptop"                        
[85] "movie-camera"                   "camera"                        
[87] "key"                            "question-mark"                 
[89] "exclamation-mark"               "trident-emblem"                </code></pre>
</div>
</div>
</details>
<p>Now, thanks to <a href="https://purrr.tidyverse.org/">the {purrr} package</a>, we can iterate over these pages and extract each emoji image URL.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> You have to update your <code>bow()</code> with a <code>nod()</code> for each new page you want to scrape.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>scrape_sb_gif <span class="ot">&lt;-</span> <span class="cf">function</span>(sb_ext, <span class="at">bow =</span> ep_bow) {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  session <span class="ot">&lt;-</span> <span class="fu">nod</span>(ep_bow, sb_ext)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  images <span class="ot">&lt;-</span> <span class="fu">scrape</span>(session) <span class="sc">|&gt;</span> <span class="fu">html_nodes</span>(<span class="st">"img"</span>) <span class="sc">|&gt;</span> <span class="fu">html_attr</span>(<span class="st">"src"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  images[<span class="fu">grepl</span>(<span class="st">".gif$"</span>, images)]</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>sb97_img <span class="ot">&lt;-</span> <span class="fu">map_chr</span>(sb97_urls, scrape_sb_gif)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sb97_img)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "https://em-content.zobj.net/thumbs/160/softbank/182/smiling-face-with-open-mouth_1f603.gif"  
[2] "https://em-content.zobj.net/thumbs/160/softbank/182/smiling-face-with-smiling-eyes_1f60a.gif"
[3] "https://em-content.zobj.net/thumbs/160/softbank/182/disappointed-face_1f61e.gif"             
[4] "https://em-content.zobj.net/thumbs/160/softbank/182/angry-face_1f620.gif"                    
[5] "https://em-content.zobj.net/thumbs/160/softbank/182/pile-of-poo_1f4a9.gif"                   
[6] "https://em-content.zobj.net/thumbs/160/softbank/182/kiss-mark_1f48b.gif"                     </code></pre>
</div>
</div>
<p>So, looks like these are stored on AWS servers.</p>
</section>
<section id="download-and-convert" class="level2">
<h2 class="anchored" data-anchor-id="download-and-convert">Download and convert</h2>
<p>Now we can download the emoji images. Here I’m going to download them to a temporary folder. I’ve also chosen to insert manually a random one- to five-second delay between downloads here to limit the impact on the server.</p>
<p>Note that the <code>download.file()</code> function prints an output for each downloaded file, but I’ve hidden this because there’s 90 outputs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create temporary folder to write into</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">tempdir</span>()</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Download each file and give it the emoji name</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">walk2</span>(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  sb97_img,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">basename</span>(sb97_urls),</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>{ <span class="fu">cat</span>(<span class="st">"Downloading"</span>, .y, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download.file</span>(.x, <span class="fu">file.path</span>(tmp, <span class="fu">paste0</span>(.y, <span class="st">".gif"</span>)))</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span>)) }</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We actually want PNG format for the next step, not gifs. One way to do this is to read in the gifs as <a href="https://docs.ropensci.org/magick/index.html">{magick}</a> objects and then write them back out to png.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>gif_paths <span class="ot">&lt;-</span> <span class="fu">list.files</span>(tmp, <span class="at">pattern =</span> <span class="st">".gif"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>png_paths <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"gif"</span>, <span class="st">"png"</span>, gif_paths)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">walk2</span>(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  gif_paths,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  png_paths,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span><span class="fu">image_read</span>(.x) <span class="sc">|&gt;</span> <span class="fu">image_write</span>(.y, <span class="at">format =</span> <span class="st">"png"</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="generate-outputs" class="level2">
<h2 class="anchored" data-anchor-id="generate-outputs">Generate outputs</h2>
<section id="pixel-plots" class="level3">
<h3 class="anchored" data-anchor-id="pixel-plots">Pixel plots</h3>
<p>First, we need a function to read the PNGs and create a 32 by 32 matrix representing the pixels of the image.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>pixelate_emoji <span class="ot">&lt;-</span> <span class="cf">function</span>(path_in) {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">readPNG</span>(path_in)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">as.vector</span>(x), <span class="dv">32</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>(y[<span class="fu">nrow</span>(y)<span class="sc">:</span><span class="dv">1</span>, <span class="dv">33</span><span class="sc">:</span><span class="dv">64</span>])</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can take the matrix output from <code>pixelate_emoji()</code> and create a plot of that emoji’s pixels using the <code>image()</code> function from base R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>plot_emoji <span class="ot">&lt;-</span> <span class="cf">function</span>(emo_mat, <span class="at">col_px =</span> <span class="st">"black"</span>, <span class="at">col_bg =</span> <span class="st">"white"</span>) {</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">image</span>(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    emo_mat,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">c</span>(col_bg, col_px),</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">useRaster =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">axes =</span> <span class="cn">FALSE</span>, <span class="at">xaxs =</span> <span class="cn">NULL</span>, <span class="at">yaxs =</span> <span class="cn">NULL</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can create a grid of them all.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">9</span>), <span class="at">mar =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">4</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(png_paths, <span class="sc">~</span><span class="fu">pixelate_emoji</span>(.x) <span class="sc">|&gt;</span> <span class="fu">plot_emoji</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot-emoji-grid-1.png" class="img-fluid" style="width:100.0%" alt="A 10 by 9 grid of black-and-white pixelated emoji from the original 1997 SoftBank set."></p>
</div>
</div>
<p>Some are a bit peculiar. The faces look like onions or dumplings, for example. But the vast majority are recognisable as emoji that persist today. Note the poo with a smiley face; this emoji is not recent!</p>
<p>Here’s three emoji, but closer.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>), <span class="at">mar =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">4</span>))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  png_paths[<span class="fu">c</span>(<span class="dv">82</span>, <span class="dv">19</span>, <span class="dv">55</span>)],</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span><span class="fu">pixelate_emoji</span>(.x) <span class="sc">|&gt;</span> <span class="fu">plot_emoji</span>()</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot-three-emoji-1.png" class="img-fluid" style="width:100.0%" alt="Three black-and-white pixelated emoji from the original 1997 SoftBank set. From left-to-right they are a thumbs-up, a disappointed face and a smiling poo."></p>
</div>
</div>
<p>Or, in modern parlance: 👍😞💩</p>
</section>
<section id="write-svgs" class="level3">
<h3 class="anchored" data-anchor-id="write-svgs">Write SVGs</h3>
<p>We can save each plot into <a href="https://en.wikipedia.org/wiki/Scalable_Vector_Graphics">SVG (Scalable Vector Graphics) format</a> using <a href="https://svglite.r-lib.org/reference/svglite.html">the {svglite} package</a>, which can be put in a function that accepts a matrix that’s output from <code>pixelate_emoji()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>save_emoji <span class="ot">&lt;-</span> <span class="cf">function</span>(emo_mat, file_out, <span class="at">dimn =</span> <span class="dv">10</span>) {</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">svglite</span>(file_out, <span class="at">width =</span> dimn, <span class="at">height =</span> dimn)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_emoji</span>(emo_mat)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dev.off</span>()</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now to convert all the PNGs to SVGs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>svg_paths <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"png"</span>, <span class="st">"svg"</span>, png_paths)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">walk2</span>(</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  png_paths, </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  svg_paths,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span><span class="fu">save_emoji</span>(<span class="fu">pixelate_emoji</span>(.x), <span class="at">file_out =</span> .y)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can demonstrate the benefit of SVGs by plotting a scraped PNG emoji (the excellent ‘spouting whale’) at small, medium and large sizes (25, 100 and 500 pixels square) and then do the same for the SVGs.</p>
<p>First the PNG, which look more fuzzy as the image gets larger:</p>
<p><img src="resources/spouting-whale.png" width="25" height="25"> <img src="resources/spouting-whale.png" width="100" height="100"> <img src="resources/spouting-whale.png" width="500" height="500"></p>
<p>Now the SVGs, which look sharp at all sizes:</p>
<p><img src="resources/spouting-whale.svg" width="25" height="25"> <img src="resources/spouting-whale.svg" width="100" height="100"> <img src="resources/spouting-whale.svg" width="500" height="500"></p>
<p>This happens because an SVG is basically a text file of instructions on how to build the image that an interpreter can re-build from scratch at any size. Hence the word ‘scalable’ in ‘SVG’.</p>
</section>
</section>
<section id="licensing" class="level2">
<h2 class="anchored" data-anchor-id="licensing">Licensing?</h2>
<p>This was a project to remind me about ‘polite’ scraping and the powers of SVG graphics. But maybe the outputs could be useful for archival purposes or something?</p>
<p>I can’t be completely certain of licensing for this particular emoji set (even <a href="https://emojipedia.org/licensing/">Emojipedia isn’t always sure</a>), but I certainly can’t and don’t condone their use for any commercial activities; they belong to <a href="https://en.wikipedia.org/wiki/SoftBank_Group">SoftBank</a>. I’ve used a few images in this post for demonstration purposes only.</p>
<p>I’ve made the code <a href="https://github.com/matt-dray/og-emoji-svg">available in a GitHub repo</a> that you can use for personal investigation, but I haven’t included any of the outputs there. Let me know if you find a use for this, lol.</p>
</section>



<div id="quarto-appendix" class="default"><section id="environment" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">Environment</h2><div class="quarto-appendix-contents">

<details>
<summary>
Session info
</summary>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Last rendered: 2023-07-09 11:20:59 BST</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.3.1 (2023-06-16)
Platform: aarch64-apple-darwin20 (64-bit)
Running under: macOS Ventura 13.2.1

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: Europe/London
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] magick_2.7.4  png_0.1-8     svglite_2.1.1 purrr_1.0.1   rvest_1.0.3  
[6] polite_0.1.3 

loaded via a namespace (and not attached):
 [1] jsonlite_1.8.7    compiler_4.3.1    selectr_0.4-2     Rcpp_1.0.11      
 [5] xml2_1.3.4        stringr_1.5.0     assertthat_0.2.1  spiderbar_0.2.5  
 [9] systemfonts_1.0.4 yaml_2.3.7        fastmap_1.1.1     mime_0.12        
[13] R6_2.5.1          curl_5.0.1        knitr_1.43.1      htmlwidgets_1.6.2
[17] rlang_1.1.1       cachem_1.0.8      stringi_1.7.12    xfun_0.39        
[21] fs_1.6.2          memoise_2.0.1     cli_3.6.1         magrittr_2.0.3   
[25] digest_0.6.31     rstudioapi_0.14   lifecycle_1.0.3   ratelimitr_0.4.1 
[29] vctrs_0.6.3       robotstxt_0.7.13  evaluate_0.21     glue_1.6.2       
[33] rmarkdown_2.23    httr_1.4.6        tools_4.3.1       usethis_2.2.1    
[37] htmltools_0.5.5  </code></pre>
</div>
</div>
</details>


</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Note that I’m using the new (at time of writing) base R pipe, <code>|&gt;</code>, rather than the {magrittr} pipe, <code>%&gt;%</code>, so you’ll need R v4.1 or higher to run this code.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div id="quarto-reuse" class="quarto-appendix-contents"><div>CC BY-NC-SA 4.0</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>