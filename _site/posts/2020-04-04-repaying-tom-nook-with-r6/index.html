<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.176">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Matt Dray">
<meta name="dcterms.date" content="2020-04-04">

<title>rostrum.blog - Repaying Tom Nook with {R6}</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/logo-black-trans.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "keyboard-shortcut": [
    null
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/logo-green-trans.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">rostrum.blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target=""><i class="bi bi-question-circle-fill" role="img">
</i> 
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../index.xml" rel="" target=""><i class="bi bi-rss-fill" role="img" aria-label="RSS feed">
</i> 
 <span class="menu-text">RSS</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/matt-dray/rostrum-blog-2" rel="" target=""><i class="bi bi-github" role="img" aria-label="GitHub source code">
</i> 
 <span class="menu-text">Source</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Repaying Tom Nook with {R6}</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">oop</div>
                <div class="quarto-category">r</div>
                <div class="quarto-category">R6</div>
                <div class="quarto-category">videogames</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://www.matt-dray.com">Matt Dray</a> </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 4, 2020</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#tldr" id="toc-tldr" class="nav-link active" data-scroll-target="#tldr">tl;dr</a></li>
  <li><a href="#what-do-those-words-mean" id="toc-what-do-those-words-mean" class="nav-link" data-scroll-target="#what-do-those-words-mean">What do those words mean?</a>
  <ul class="collapse">
  <li><a href="#animal-crossing" id="toc-animal-crossing" class="nav-link" data-scroll-target="#animal-crossing">Animal Crossing</a></li>
  <li><a href="#tom-nook" id="toc-tom-nook" class="nav-link" data-scroll-target="#tom-nook">Tom Nook</a></li>
  <li><a href="#automatic-bell-dispenser" id="toc-automatic-bell-dispenser" class="nav-link" data-scroll-target="#automatic-bell-dispenser">Automatic Bell Dispenser</a></li>
  <li><a href="#r6" id="toc-r6" class="nav-link" data-scroll-target="#r6">R6</a></li>
  </ul></li>
  <li><a href="#demo" id="toc-demo" class="nav-link" data-scroll-target="#demo">Demo</a>
  <ul class="collapse">
  <li><a href="#use-the-class" id="toc-use-the-class" class="nav-link" data-scroll-target="#use-the-class">Use the class</a></li>
  <li><a href="#build-the-class" id="toc-build-the-class" class="nav-link" data-scroll-target="#build-the-class">Build the class</a></li>
  </ul></li>
  <li><a href="#what-now-squirt" id="toc-what-now-squirt" class="nav-link" data-scroll-target="#what-now-squirt">What now, squirt?</a></li>
  
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="resources/ac-flag2.jpg" class="img-fluid figure-img" style="width:100.0%" alt="An Animal Crossing villager stands in front of the town flag, which has the R logo on it."></p>
<figcaption class="figure-caption">I assume the other villagers are happy with my choice of town flag.</figcaption>
</figure>
</div>
<section id="tldr" class="level2">
<h2 class="anchored" data-anchor-id="tldr">tl;dr</h2>
<p>How would <a href="https://animalcrossing.fandom.com/wiki/Tom_Nook">capitalist raccoon-dog Tom Nook</a> simulate home-loan payments using R?<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>I built a version of <a href="https://en.wikipedia.org/wiki/Animal_Crossing">Animal Crossing</a>’s <a href="https://animalcrossing.fandom.com/wiki/Bells">Automatic Bell Dispenser</a> (a kind of ATM/cashpoint) using <a href="https://twitter.com/winston_chang">Winston Chang</a>’s <a href="https://r6.r-lib.org/">{R6} package</a>, inspired by an exercise from <a href="http://hadley.nz/">Hadley Wickham</a>’s <a href="https://adv-r.hadley.nz/r6.html">Advanced R</a> book.</p>
</section>
<section id="what-do-those-words-mean" class="level2">
<h2 class="anchored" data-anchor-id="what-do-those-words-mean">What do those words mean?</h2>
<section id="animal-crossing" class="level3">
<h3 class="anchored" data-anchor-id="animal-crossing">Animal Crossing</h3>
<p><a href="https://en.wikipedia.org/wiki/Animal_Crossing">Animal Crossing</a> is a wholesome Nintendo videogame franchise in which you arrive on an island and befriend <a href="https://animalcrossing.fandom.com/wiki/Villager_list_(New_Horizons)">anthropomorphic animal villagers</a>. You can catch insects and fish, design clothes, fill a museum with fossils, develop the infrastructure of the island and interact with other players. It’s pretty chill.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> The latest version, New Horizons, was recently released.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
</section>
<section id="tom-nook" class="level3">
<h3 class="anchored" data-anchor-id="tom-nook">Tom Nook</h3>
<p><a href="https://animalcrossing.fandom.com/wiki/Tom_Nook">Tom Nook</a> is a <a href="https://en.wikipedia.org/wiki/Japanese_raccoon_dog">tanuki</a>. Depending on who you ask, he’s either a maniacal <a href="https://www.vice.com/en_us/article/n7jyjd/tom-nook-ripping-you-off-animal-crossing-new-horizons-bells-to-usd">rip-off merchant</a>,<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> or <a href="https://www.theverge.com/2020/3/18/21184928/animal-crossing-new-horizons-nintendo-switch-interview-tom-nook">a misunderstood chap</a> who gives you several interest-free home loans with no obligation.</p>
</section>
<section id="automatic-bell-dispenser" class="level3">
<h3 class="anchored" data-anchor-id="automatic-bell-dispenser">Automatic Bell Dispenser</h3>
<p>The in-game currency is <a href="https://animalcrossing.fandom.com/wiki/Bells">Bells</a>, which can be gained by selling things, helping residents, hitting rocks with a spade and joining the ‘stalk market’ by buying and flipping turnips. You use an <a href="https://animalcrossing.fandom.com/wiki/Automatic_Bell_Dispenser">Automatic Bell Dispenser</a> to deposit, withdraw and make loan payments.</p>
</section>
<section id="r6" class="level3">
<h3 class="anchored" data-anchor-id="r6">R6</h3>
<p>R is primarily a function-focused language: mostly you’re writing functions that output objects.</p>
<p>But there’s also Object-Oriented Programming (OOP), which is common in many other languages. OOP brings together values (fields) and functions (methods) into classes. You can interact with a class via its methods, which may trigger further internal methods and update the values. You can also create subclasses that add to or amend the logic of its parent.</p>
<p>You may have heard of the object-oriented systems <a href="https://adv-r.hadley.nz/s3.html">S3</a> and <a href="https://adv-r.hadley.nz/s4.html">S4</a> in R; R6 provides another, newer implementation of OOP. There are two important things to know about R6 objects. To simplify, they’re:</p>
<ul>
<li><em>encapsulated</em>, meaning that you apply the methods to object directly, like <code>object$some_method()</code></li>
<li><em>mutable</em>, meaning that fields are updated as you apply the methods</li>
</ul>
<p>I’m not going into depth about OOP and R6 here. For more, I recommend:</p>
<ul>
<li>the <a href="https://r6.r-lib.org/articles/Introduction.html">{R6} introduction vignette</a> by <a href="https://twitter.com/winston_chang">Winston Chang</a></li>
<li>a chapter in <a href="https://adv-r.hadley.nz/oo.html">Advanced R</a> by <a href="http://hadley.nz/">Hadley Wickham</a><a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></li>
<li>the article ‘<a href="https://www.freecodecamp.org/news/object-oriented-programming-concepts-21bb035f7260/">How to explain OOP concepts to a 6-year-old</a>’ by Alexander Petkov of <a href="https://www.freecodecamp.org/">freeCodeCamp</a></li>
</ul>
<p>A really intriguing and illustrative use-case of R6 is <a href="http://giorasimchoni.com/">Giora Simonchi</a>‘s <a href="http://giorasimchoni.com/2017/09/10/2017-09-10-you-re-in-a-room-the-castleofr-package/">Castle of R</a>, which is a text adventure game for R (!). Here, classes are things like ’room’ and ‘door’ that have specific properties and actions you can take on them. As you play, the fields are modified depending on your location, interactions you’ve had, or items you’re carrying.</p>
</section>
</section>
<section id="demo" class="level2">
<h2 class="anchored" data-anchor-id="demo">Demo</h2>
<p>The R6 chapter of the Advanced R book has <a href="https://adv-r.hadley.nz/r6.html#exercises-44">an exercise</a> about building a bank account class.</p>
<p>Inspired by this, I’ve built an <code>AutomaticBellDispenser</code> class with certain fields (<code>savings</code> and <code>loan</code> values) and methods (<code>deposit()</code>, <code>withdraw()</code> and <code>loan_payment()</code> functions) that mimic the functionality of an Automatic Bell Dispenser. <a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="resources/ac-abd.jpg" class="img-fluid figure-img" style="width:100.0%" alt="The user interface for the Automatic Bell Dispenser, with buttons to deposit, withdraw and pay the loan."></p>
<figcaption class="figure-caption">The Automatic Bell Dispenser interface. The grind is real.</figcaption>
</figure>
</div>
<p>You can click below to expand the code, but it may be a lot to take in at once. Skip ahead to the next section to see examples of its use and then some explanations of specific bits of the code.</p>
<details>
<summary>
Click to expand the full <code>AutomaticBellDispenser</code> class.
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(R6)  <span class="co"># install.packages("R6")</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emo)  <span class="co"># remotes::install_github("hadley/emo")</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Build the class</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>AutomaticBellDispenser <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AutomaticBellDispenser"</span>,  <span class="co"># class name</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># set initial values for fields</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">savings =</span> <span class="dv">0</span>,     <span class="co"># start from zero</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">loan =</span> <span class="dv">2498000</span>,  <span class="co"># loan size</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># show on startup the account status and options</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">initialize =</span> <span class="cf">function</span>(...) {</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>      loan_formatted <span class="ot">&lt;-</span> <span class="fu">format</span>(  <span class="co"># reformat the loan field value</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        self<span class="sc">$</span>loan,          <span class="co"># the 'loan' field from this class (i.e. 'itself')</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">big.mark =</span> <span class="st">","</span>,     <span class="co"># format as '1,000' rather than '1000'</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">scientific =</span> <span class="cn">FALSE</span>  <span class="co"># prevent 12000000 being displayed as '1.2e+07'</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>      savings_formatted <span class="ot">&lt;-</span> <span class="fu">format</span>(  <span class="co"># reformat the savings field value</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        self<span class="sc">$</span>savings, <span class="at">big.mark =</span> <span class="st">","</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Automatic Bell Dispenser (ABD)</span><span class="sc">\n\n</span><span class="st">"</span>)  <span class="co"># cat() prints to console</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(emo<span class="sc">::</span><span class="fu">ji</span>(<span class="st">"bell"</span>), <span class="st">"Loan Balance:"</span>, loan_formatted, <span class="st">"Bells</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(emo<span class="sc">::</span><span class="fu">ji</span>(<span class="st">"pig2"</span>), <span class="st">"Savings Balance:"</span>, savings_formatted, <span class="st">"Bells</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Please make a selection from the menu below</span><span class="sc">\n\n</span><span class="st">"</span>,</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        emo<span class="sc">::</span><span class="fu">ji</span>(<span class="st">"house"</span>), <span class="st">"loan_payment()</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        emo<span class="sc">::</span><span class="fu">ji</span>(<span class="st">"arrow_up"</span>), <span class="st">"deposit()</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>        emo<span class="sc">::</span><span class="fu">ji</span>(<span class="st">"arrow_down"</span>), <span class="st">"withdraw()"</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># method to deposit an amount into savings</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">deposit =</span> <span class="cf">function</span>(<span class="at">amount =</span> <span class="dv">0</span>) {    <span class="co"># function takes an amount to deposit</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>      amount_int <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(amount)  <span class="co"># round to nearest lowest integer</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (amount <span class="sc">-</span> amount_int <span class="sc">&gt;</span> <span class="dv">0</span>) {    <span class="co"># warning if rounding has occurred</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Deposit rounded to "</span>, amount_int, <span class="st">" Bells.</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>          <span class="at">call. =</span> <span class="cn">FALSE</span> <span class="co"># prevents printing of the error-causing line</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>        self<span class="sc">$</span>savings <span class="ot">&lt;-</span> self<span class="sc">$</span>savings <span class="sc">+</span> amount_int  <span class="co"># add amount to savings</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>      <span class="fu">invisible</span>(self)  <span class="co"># return but don't print</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># function to withdraw an amount from savings</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">withdraw =</span> <span class="cf">function</span>(<span class="at">amount =</span> <span class="dv">0</span>) {</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>      amount_int <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(amount)  <span class="co"># round to nearest lowest integer</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (amount <span class="sc">-</span> amount_int <span class="sc">&gt;</span> <span class="dv">0</span>) {  <span class="co"># warning if rounding has occurred</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="st">"Withdrawal rounded to "</span>, amount_int, <span class="st">" Bells.</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (self<span class="sc">$</span>savings <span class="sc">-</span> amount_int <span class="sc">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(  <span class="co"># can't withdraw more than you have so warn and take max</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Withdrew all savings: "</span>, self<span class="sc">$</span>savings, <span class="st">" Bells.</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">call. =</span> <span class="cn">FALSE</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>        self<span class="sc">$</span>savings <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {  <span class="co"># otherwise subtract amount from your savings</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>        self<span class="sc">$</span>savings <span class="ot">&lt;-</span> self<span class="sc">$</span>savings <span class="sc">-</span> amount_int</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>      <span class="fu">invisible</span>(self)  <span class="co"># return but don't print</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># function to make loan payment from savings</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">loan_payment =</span> <span class="cf">function</span>(<span class="at">amount =</span> <span class="dv">0</span>, <span class="at">full_amount =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (self<span class="sc">$</span>loan <span class="sc">==</span> <span class="dv">0</span>) {  <span class="co"># stop if the loan has already been paid in full</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"You already finished paying your loan!</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>      amount_int <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(amount)  <span class="co"># round to nearest lowest integer</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (amount <span class="sc">-</span> amount_int <span class="sc">&gt;</span> <span class="dv">0</span>) {  <span class="co"># warning if rounding has occurred</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="st">"Payment rounded to "</span>, amount_int, <span class="st">" Bells.</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (full_amount <span class="sc">==</span> <span class="cn">TRUE</span>) {  <span class="co"># choose to pay with everything in savings</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>        self<span class="sc">$</span>loan <span class="ot">&lt;-</span> self<span class="sc">$</span>loan <span class="sc">-</span> self<span class="sc">$</span>savings  <span class="co"># reduce loan by savings amount</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>        self<span class="sc">$</span>savings <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># remove all savings</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (self<span class="sc">$</span>savings <span class="sc">-</span> amount_int <span class="sc">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(  <span class="co"># can't pay more than total savings, so warn and pay max</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Paid total amount from savings instead: "</span>, self<span class="sc">$</span>savings, <span class="st">" Bells.</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>          <span class="at">call. =</span> <span class="cn">FALSE</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>        self<span class="sc">$</span>loan <span class="ot">&lt;-</span> self<span class="sc">$</span>loan <span class="sc">-</span> self<span class="sc">$</span>savings  <span class="co"># subtract total savings</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>        self<span class="sc">$</span>savings <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># all savings used for this repayment</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (self<span class="sc">$</span>loan <span class="sc">-</span> amount_int <span class="sc">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(  <span class="co"># can't pay more than remaining loan, warn and pay remaining</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Paid total remaining loan instead: "</span>, self<span class="sc">$</span>loan, <span class="st">" Bells.</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>          <span class="at">call. =</span> <span class="cn">FALSE</span></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>        self<span class="sc">$</span>loan <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># loan paid in full</span></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>        self<span class="sc">$</span>savings <span class="ot">&lt;-</span> amount_int <span class="sc">-</span> self<span class="sc">$</span>loan  <span class="co"># excess back into savings</span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {  <span class="co"># otherwise just remove the amount from the savings and loan</span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>        self<span class="sc">$</span>savings <span class="ot">&lt;-</span> self<span class="sc">$</span>savings <span class="sc">-</span> amount_int</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>        self<span class="sc">$</span>loan <span class="ot">&lt;-</span> self<span class="sc">$</span>loan <span class="sc">-</span> amount_int</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (self<span class="sc">$</span>loan <span class="sc">==</span> <span class="dv">0</span>) {  <span class="co"># when the loan is totally cleared</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>          emo<span class="sc">::</span><span class="fu">ji</span>(<span class="st">"smiley"</span>),</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Sweet! I finally finished paying off my very last home loan!"</span>,</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>          emo<span class="sc">::</span><span class="fu">ji</span>(<span class="st">"tada"</span>), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>      <span class="fu">invisible</span>(self)  <span class="co"># return but don't print</span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print method wen calling the name of an object with this class</span></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (Content matches the initialise method)</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>    <span class="at">print =</span> <span class="cf">function</span>(...) {</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>      loan_formatted <span class="ot">&lt;-</span> <span class="fu">format</span>(self<span class="sc">$</span>loan, <span class="at">big.mark =</span> <span class="st">","</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>      savings_formatted <span class="ot">&lt;-</span> <span class="fu">format</span>(</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>        self<span class="sc">$</span>savings, <span class="at">big.mark =</span> <span class="st">","</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Automatic Bell Dispenser (ABD)</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(emo<span class="sc">::</span><span class="fu">ji</span>(<span class="st">"bell"</span>), <span class="st">"Loan Balance:"</span>, loan_formatted, <span class="st">"Bells</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(emo<span class="sc">::</span><span class="fu">ji</span>(<span class="st">"pig2"</span>), <span class="st">"Savings Balance:"</span>, savings_formatted, <span class="st">"Bells</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Please make a selection from the menu below</span><span class="sc">\n\n</span><span class="st">"</span>,</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>        emo<span class="sc">::</span><span class="fu">ji</span>(<span class="st">"house"</span>), <span class="st">"loan_payment()</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>        emo<span class="sc">::</span><span class="fu">ji</span>(<span class="st">"arrow_up"</span>), <span class="st">"deposit()</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>        emo<span class="sc">::</span><span class="fu">ji</span>(<span class="st">"arrow_down"</span>), <span class="st">"withdraw()"</span></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<section id="use-the-class" class="level3">
<h3 class="anchored" data-anchor-id="use-the-class">Use the class</h3>
<p>How can you use this class? I’ll explain below how to:</p>
<ul>
<li>start a new instance of the class</li>
<li>use the <code>deposit()</code> method to increase the value of the <code>savings</code> field</li>
<li>use the <code>withdraw()</code> method to decrease the <code>savings</code> field</li>
<li>use the <code>pay_loan()</code> method to decrease the value of the <code>loan</code> field</li>
</ul>
<section id="initialise" class="level4">
<h4 class="anchored" data-anchor-id="initialise">Initialise</h4>
<p>You can start, or ‘initialise’, an instance of the class by calling <code>new()</code> on the class name and assigning it. I’ve called my object <code>account</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>account <span class="ot">&lt;-</span> AutomaticBellDispenser<span class="sc">$</span><span class="fu">new</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Automatic Bell Dispenser (ABD)

🔔 Loan Balance: 2,498,000 Bells
🐖 Savings Balance: 0 Bells

Please make a selection from the menu below

 🏠 loan_payment()
 ⬆️ deposit()
 ⬇️ withdraw()</code></pre>
</div>
</div>
<p>Initialising the class also triggers the printing of the current account details and instructions. This mimics the interface you see on the Automatic Bell Dispenser in-game.</p>
<p>In this case, you can see that we have zero savings, but a multi-million loan to pay off (!). This value represents the final loan amount that Nook sets you in the game.<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a></p>
</section>
<section id="make-a-deposit" class="level4">
<h4 class="anchored" data-anchor-id="make-a-deposit">Make a deposit</h4>
<p>Now we can make a deposit to our account. Use <code>$</code> notation to say ‘to the <code>account</code> object apply the <code>deposit</code> method’. In this case, the value supplied to <code>deposit</code> is the amount of Bells.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>account<span class="sc">$</span><span class="fu">deposit</span>(<span class="dv">1000</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>account  <span class="co"># check status of account</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Automatic Bell Dispenser (ABD)

🔔 Loan Balance: 2,498,000 Bells
🐖 Savings Balance: 1,000 Bells

Please make a selection from the menu below

 🏠 loan_payment()
 ⬆️ deposit()
 ⬇️ withdraw()</code></pre>
</div>
</div>
<p>You could also access the <code>savings</code> field directly from the <code>account</code> object:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>account<span class="sc">$</span>savings</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1000</code></pre>
</div>
</div>
<p>So we now have savings of 1000 Bells! Of course, I just made up that value. I could add as much as I want. Use your imagination!</p>
<p>In the game you have to complete various tasks to add money to your pocket. You can then deposit from your pocket into your savings. I haven’t created the concept of ‘pockets’ in this demo, but you could create a <code>pocket</code> class. You could also, for example, create a <code>fish</code> class with subclasses for each species, including their trade value. You could, in theory, mimic the entirety of Animal Crossing in this way.</p>
</section>
<section id="withdraw-and-pay-loan" class="level4">
<h4 class="anchored" data-anchor-id="withdraw-and-pay-loan">Withdraw and pay loan</h4>
<p>We can also withdraw Bells and make loan payments with this class.</p>
<p>Note that you can chain method calls together with <code>$</code> between them, so we could withdraw 200 Bells and make a loan payment of 300 Bells at once.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>account<span class="sc">$</span><span class="fu">withdraw</span>(<span class="dv">200</span>)<span class="sc">$</span><span class="fu">loan_payment</span>(<span class="dv">300</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>account</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Automatic Bell Dispenser (ABD)

🔔 Loan Balance: 2,497,700 Bells
🐖 Savings Balance: 500 Bells

Please make a selection from the menu below

 🏠 loan_payment()
 ⬆️ deposit()
 ⬇️ withdraw()</code></pre>
</div>
</div>
<p>So the loan amount was reduced by 300 Bells, but our savings reduced by 500 Bells (200 + 300 Bells).</p>
<p>Important point: notice how we didn’t have to overwrite the <code>account</code> object to update the values? Remember that this is because the class is <a href="#r6"><em>mutable</em></a>.</p>
<p>As in the game, you can also choose to transfer everything in your savings by providing <code>full_amount = TRUE</code> rather than a value amount.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>account<span class="sc">$</span><span class="fu">loan_payment</span>(<span class="at">full_amount =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>account</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Automatic Bell Dispenser (ABD)

🔔 Loan Balance: 2,497,200 Bells
🐖 Savings Balance: 0 Bells

Please make a selection from the menu below

 🏠 loan_payment()
 ⬆️ deposit()
 ⬇️ withdraw()</code></pre>
</div>
</div>
<p>So the loan balance has gone down by a further 500 bells, which was the remainder of our savings.</p>
</section>
<section id="messages" class="level4">
<h4 class="anchored" data-anchor-id="messages">Messages</h4>
<p>There are some limits to the Automatic Bell Dispenser system; there’s no overdraft and the outstanding loan amount can’t be negative, for example. I built a few warnings and errors into the class to handle these situations. For example:</p>
<ul>
<li>warning – you can only pay in whole Bells (decimal amounts are rounded down to the nearest whole number)</li>
<li>warning – you can’t remove more savings than you have (defaults to removing the maximum amount you have in savings)</li>
<li>warning – you can’t pay off more than the total loan amount (defaults to paying total remaining loan)</li>
<li>error – once you pay off your loan, you can’t make more payments!</li>
</ul>
<p>You’ll also get a celebratory message when the loan reaches zero.</p>
<p>So, for example, here’s what happens if you try to pay off the loan with more savings than you have and if you also try to pay in decimal Bells:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>account<span class="sc">$</span><span class="fu">deposit</span>(<span class="dv">1000</span>)<span class="sc">$</span><span class="fu">loan_payment</span>(<span class="fl">1001.10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Payment rounded to 1001 Bells.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Paid total amount from savings instead: 1000 Bells.</code></pre>
</div>
</div>
<p>We got two warnings:</p>
<ol type="1">
<li>The decimal value was rounded down to the nearest integer</li>
<li>We tried to pay off 1001 Bells, but only had a total of 1000 Bells</li>
</ol>
<p>The result is that our savings are empty and the loan is 1000 Bells lighter.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>account<span class="sc">$</span>savings</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>account<span class="sc">$</span>loan</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2496200</code></pre>
</div>
</div>
<p>And if we add enough Bells to pay off the loan?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>account<span class="sc">$</span><span class="fu">deposit</span>(<span class="dv">2496200</span>)<span class="sc">$</span><span class="fu">loan_payment</span>(<span class="at">full_amount =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>😃 Sweet! I finally finished paying off my very last home loan! 🎉 </code></pre>
</div>
</div>
</section>
</section>
<section id="build-the-class" class="level3">
<h3 class="anchored" data-anchor-id="build-the-class">Build the class</h3>
<p>I wanted to point out a few elements of the code that went into building the class. You can refer back to the full code in <a href="#demo">the expandable section above</a>.</p>
<p>First, the basic structure is a call to <code>R6::R6Class()</code>, which contains the name of the class and a list of values and fields.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>AutomaticBellDispenser <span class="ot">&lt;-</span> <span class="fu">R6Class</span>(  <span class="co"># call the function, assign a name</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AutomaticBellDispenser"</span>,  <span class="co"># class name</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># truncated (fields and methods go here)</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are two fields in this class, which are put inside the <code>list()</code> with some starting values:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#...</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set initial values for fields</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  savings <span class="ot">=</span> <span class="dv">0</span>,     <span class="co"># start from zero</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  loan <span class="ot">=</span> <span class="dv">2498000</span>,  <span class="co"># loan size</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">#...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There’s an <code>initialize()</code> method that I’ve used to print the Automatic Bell Dispenser display when a new instance of the class is started. It reformats values and uses emoji for the lols.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#...</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># show on startup the account status and options</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  initialize <span class="ot">=</span> <span class="cf">function</span>(...) {</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    loan_formatted <span class="ot">&lt;-</span> <span class="fu">format</span>(  <span class="co"># reformat the loan field value</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>      self<span class="sc">$</span>loan,          <span class="co"># the 'loan' field from this class (i.e. 'itself')</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">big.mark =</span> <span class="st">","</span>,     <span class="co"># format as '1,000' rather than '1000'</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">scientific =</span> <span class="cn">FALSE</span>  <span class="co"># prevent 12000000 being displayed as '1.2e+07'</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    savings_formatted <span class="ot">&lt;-</span> <span class="fu">format</span>(  <span class="co"># reformat the savings field value</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>      self<span class="sc">$</span>savings, <span class="at">big.mark =</span> <span class="st">","</span>, <span class="at">scientific =</span> <span class="cn">FALSE</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Automatic Bell Dispenser (ABD)</span><span class="sc">\n\n</span><span class="st">"</span>)  <span class="co"># cat() prints to console</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(emo<span class="sc">::</span><span class="fu">ji</span>(<span class="st">"bell"</span>), <span class="st">"Loan Balance:"</span>, loan_formatted, <span class="st">"Bells</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(emo<span class="sc">::</span><span class="fu">ji</span>(<span class="st">"pig2"</span>), <span class="st">"Savings Balance:"</span>, savings_formatted, <span class="st">"Bells</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Please make a selection from the menu below</span><span class="sc">\n\n</span><span class="st">"</span>,</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>      emo<span class="sc">::</span><span class="fu">ji</span>(<span class="st">"house"</span>), <span class="st">"loan_payment()</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>      emo<span class="sc">::</span><span class="fu">ji</span>(<span class="st">"arrow_up"</span>), <span class="st">"deposit()</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>      emo<span class="sc">::</span><span class="fu">ji</span>(<span class="st">"arrow_down"</span>), <span class="st">"withdraw()"</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="co">#...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The same code is used in the <code>print()</code> method too, which means that these details will be printed whenever you call your object.</p>
<p>The methods for <code>deposit()</code>, <code>withdraw()</code> and <code>loan_payment()</code> look similar, but have slightly different behaviour. The simplest is <code>deposit()</code>, which makes the input an integer and warns the user if a decimal value has been used, then adds the amount to the <code>savings</code> field.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#...</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  deposit <span class="ot">=</span> <span class="cf">function</span>(<span class="at">amount =</span> <span class="dv">0</span>) {    <span class="co"># function takes an amount to deposit</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    amount_int <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(amount)  <span class="co"># round to nearest lowest integer</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (amount <span class="sc">-</span> amount_int <span class="sc">&gt;</span> <span class="dv">0</span>) {    <span class="co"># warning if rounding has occurred</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">warning</span>(</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Deposit rounded to "</span>, amount_int, <span class="st">" Bells.</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">call. =</span> <span class="cn">FALSE</span> <span class="co"># prevents printing of the error-causing line</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>      self<span class="sc">$</span>savings <span class="ot">&lt;-</span> self<span class="sc">$</span>savings <span class="sc">+</span> amount_int  <span class="co"># add amount to savings</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">invisible</span>(self)  <span class="co"># return but don't print</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="co">#...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note how the field values are accessed with <code>self$field_name</code>. We also return <code>self</code> at the end, but it’s wrapped in <code>invisible()</code> so it updates the field without printing.</p>
</section>
</section>
<section id="what-now-squirt" class="level2">
<h2 class="anchored" data-anchor-id="what-now-squirt">What now, squirt?</h2>
<p>So now you know how I’ve been spending my time during this period of enforced isolation: playing Animal Crossing, messing about with R or, most importantly, messing around with Animal Crossing in R.</p>
<p>While this use of {R6} has been totally frivolous, it’s helped me understand OOP a bit better and get more of an insight into how R works.</p>
<p>I recommend you take a look at the Advanced R book, which is <a href="https://adv-r.hadley.nz/">online for free</a> or can be <a href="https://www.crcpress.com/Advanced-R-Second-Edition/Wickham/p/book/9780815384571">purchased</a>,<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a> for a better understanding of OOP and its implementations in R.</p>
<p>I also recommend getting hold of Animal Crossing: New Horizons. Just be wary of that raccoon guy…</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="resources/ac-tarantula.jpg" class="img-fluid figure-img" style="width:100.0%" alt="The pocket interface in Animal Crossing, showing all available space filled with tarantulas."></p>
<figcaption class="figure-caption">Tip: the lucrative Tarantula Island will help you satiate Nook’s thirst for Bells.</figcaption>
</figure>
</div>
</section>



<div id="quarto-appendix" class="default"><section id="environment" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">Environment</h2><div class="quarto-appendix-contents">

<details>
<summary>
Session info
</summary>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Last rendered: 2023-07-22 15:30:34 BST</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.3.1 (2023-06-16)
Platform: aarch64-apple-darwin20 (64-bit)
Running under: macOS Ventura 13.2.1

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: Europe/London
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] emo_0.0.0.9000 R6_2.5.1      

loaded via a namespace (and not attached):
 [1] digest_0.6.33     assertthat_0.2.1  lubridate_1.9.2   fastmap_1.1.1    
 [5] xfun_0.39         magrittr_2.0.3    glue_1.6.2        stringr_1.5.0    
 [9] knitr_1.43.1      htmltools_0.5.5   timechange_0.2.0  generics_0.1.3   
[13] rmarkdown_2.23    lifecycle_1.0.3   cli_3.6.1         vctrs_0.6.3      
[17] compiler_4.3.1    purrr_1.0.1       rstudioapi_0.15.0 tools_4.3.1      
[21] evaluate_0.21     yaml_2.3.7        crayon_1.5.2      rlang_1.1.1      
[25] jsonlite_1.8.7    htmlwidgets_1.6.2 stringi_1.7.12   </code></pre>
</div>
</div>
</details>


</div></section><aside id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Literally the most important question in 2020.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Perhaps <a href="https://www.teenvogue.com/story/animal-crossing-new-horizons-comfort-coronavirus-pandemic">a literal life-saver</a> in these times of self-isolation.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>My island has peaches and lillies. Current villagers are Biff, Renee, Midge, Al and Patty.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>To be fair, <a href="https://www.youtube.com/watch?v=icyOAc_pAvY">tanuki do have a mythical reputation as tricksters. And massive balls.</a><a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Spoiler alert: there’s an online book of <a href="https://advanced-r-solutions.rbind.io/index.html">solutions to the questions</a> by Malte Grosser, Henning Bumann and Hadley Wickham.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>I don’t claim that this is an optimal approach, nor is it fully tested, but it works! Tell me how to improve it.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>Impressive, bearing in mind that the ubiquitous Sea Bass (<em>no, wait, more like a C+</em>) has a sale price of only 400 Bells.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>None of my posts are sponsored, but I <em>will</em> accept payments in the form of Bells.<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</aside><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div id="quarto-reuse" class="quarto-appendix-contents"><div>CC BY-NC-SA 4.0</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    if (id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        for (let i = 0; i < 2; i++) {
          container.appendChild(note.children[i].cloneNode(true));
        }
        return container.innerHTML
      } else {
        return note.innerHTML;
      }
    } else {
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      try { hash = new URL(url).hash; } catch {}
      const id = hash.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note !== null) {
        try {
          const html = processXRef(id, note);
          instance.setContent(html);
        } finally {
          instance.enable();
          instance.show();
        }
      } else {
        // See if we can fetch this
        fetch(url.split('#')[0])
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.getElementById(id);
          if (note !== null) {
            const html = processXRef(id, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>